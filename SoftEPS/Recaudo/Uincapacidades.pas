UNIT UINCAPACIDADES;

INTERFACE

USES
  WINDOWS, MESSAGES, SYSUTILS, VARIANTS, CLASSES, GRAPHICS, CONTROLS, FORMS,
  DIALOGS, MATH, EXTCTRLS, DBCTRLS, STDCTRLS, GRIDS, DBGRIDS, COMCTRLS, DB,
  DBTABLES, MENUS,SHELLAPI, Buttons, QuickRpt;

TYPE
  TFRMINCAPACIDADES = CLASS(TFORM)
    PANEL2: TPANEL;
    PANEL3: TPANEL;
    SGDETALLEINC: TSTRINGGRID;
    QRYAFILIADOS: TQUERY;
    QRYINCAUSUARIO: TQUERY;
    Button3: TBitBtn;
    Button2: TBitBtn;
    Panel1: TPanel;
    Image1: TImage;
    Label24: TLabel;
    Label47: TLabel;
    GroupBox1: TGroupBox;
    GroupBox2: TGroupBox;
    Label2: TLabel;
    Edtnumero: TEdit;
    Label1: TLabel;
    rgtipoincapacidad: TComboBox;
    Label7: TLabel;
    cbtipodocempresa: TComboBox;
    Label8: TLabel;
    edtnumdocempresa: TEdit;
    Label3: TLabel;
    dtpfecexpedicion: TDateTimePicker;
    Label9: TLabel;
    edtnombreempresa: TEdit;
    Label4: TLabel;
    cbtipodocafiliado: TComboBox;
    Label5: TLabel;
    edtnumdocafiliadoin: TEdit;
    Label17: TLabel;
    edtsexo: TEdit;
    edtedad: TEdit;
    edtnombreafiliado: TEdit;
    Label6: TLabel;
    Label11: TLabel;
    Label10: TLabel;
    edtcoddiagnostico: TEdit;
    edtnombrediagnostico: TEdit;
    Label12: TLabel;
    dtpfeciniciacion: TDateTimePicker;
    Label13: TLabel;
    edtdiasincapacidad: TEdit;
    valorletradias: TEdit;
    Label14: TLabel;
    Label23: TLabel;
    edtfinal: TEdit;
    chprorroga: TCheckBox;
    Label16: TLabel;
    edtcodprestador: TEdit;
    Label15: TLabel;
    edtnombreprestador: TEdit;
    Label18: TLabel;
    edtdiasliquidados: TEdit;
    Label19: TLabel;
    edtsalariobase: TEdit;
    Label20: TLabel;
    edtproliquidacion: TEdit;
    Label21: TLabel;
    edtvalorliquidado: TEdit;
    Edit1: TEdit;
    Panel4: TPanel;
    Panel5: TPanel;
    Edit2: TEdit;
    Button1: TBitBtn;
    btneliminar: TBitBtn;
    Label22: TLabel;
    Button4: TButton;
    Button5: TButton;
    Button6: TButton;
    Button7: TButton;
    Button8: TButton;
    QRCompositeReport1: TQRCompositeReport;
    PROCEDURE FORMCLOSE(SENDER: TOBJECT; VAR ACTION: TCLOSEACTION);
    PROCEDURE FORMCREATE(SENDER: TOBJECT);
    PROCEDURE EDTDIASINCAPACIDADKEYPRESS(SENDER: TOBJECT; VAR KEY: CHAR);
    PROCEDURE EDTNUMDOCEMPRESAEXIT(SENDER: TOBJECT);
    PROCEDURE EDTPROLIQUIDACIONEXIT(SENDER: TOBJECT);
    PROCEDURE EDTNUMEROEXIT(SENDER: TOBJECT);
    PROCEDURE EDTNUMDOCAFILIADOINEXIT(SENDER: TOBJECT);
    PROCEDURE EDTCODDIAGNOSTICOEXIT(SENDER: TOBJECT);
    PROCEDURE LIMPIAR;
    PROCEDURE EDTNUMEROENTER(SENDER: TOBJECT);
    PROCEDURE DTPFECINICIACIONEXIT(SENDER: TOBJECT);
    PROCEDURE EDTDIASINCAPACIDADEXIT(SENDER: TOBJECT);
    PROCEDURE EDTNUMDOCAFILIADOINCLICK(SENDER: TOBJECT);
    PROCEDURE RGTIPOINCAPACIDADEXIT(SENDER: TOBJECT);
    PROCEDURE EDTNUMDOCEMPRESACHANGE(SENDER: TOBJECT);
    PROCEDURE EDTCODPRESTADOREXIT(SENDER: TOBJECT);
    PROCEDURE REFRESCAR_INCAPACIDAD;
    PROCEDURE BUTTON3CLICK(SENDER: TOBJECT);
    PROCEDURE DIASLIQUIDADOS;
    PROCEDURE PAGOLINCENCIAS;
    PROCEDURE PAGOEFERMEDADGENERAL;
    PROCEDURE GRABARINCAPACIDADES;
    PROCEDURE BUTTON2CLICK(SENDER: TOBJECT);
    FUNCTION  VALIDAR: BOOLEAN;
    PROCEDURE EDTSALARIOBASEENTER(SENDER: TOBJECT);
    PROCEDURE VERIFICAR_INCAPACIDADES;
    PROCEDURE EDTCODDIAGNOSTICOCLICK(SENDER: TOBJECT);
    PROCEDURE EDTPROLIQUIDACIONCLICK(SENDER: TOBJECT);
    PROCEDURE VERIFICAR_CARTERA;
    PROCEDURE APPMESSAGE(VAR MSG: TMSG; VAR HANDLED: BOOLEAN);
    PROCEDURE CERRAR1CLICK(SENDER: TOBJECT);
    PROCEDURE ENVIARWORD;
    PROCEDURE USUARIOS1CLICK(SENDER: TOBJECT);
    PROCEDURE INCAPACIDADVIGENTE;
    procedure liquidar_incapacidad;
    procedure Button1Click(Sender: TObject);
    procedure dtpfecexpedicionExit(Sender: TObject);
    procedure cbtipodocempresaExit(Sender: TObject);
    procedure cbtipodocafiliadoExit(Sender: TObject);
    procedure Edit1Exit(Sender: TObject);
    procedure chprorrogaClick(Sender: TObject);
    procedure btneliminarClick(Sender: TObject);
    procedure Button4Click(Sender: TObject);
    procedure Button5Click(Sender: TObject);
    procedure FormActivate(Sender: TObject);
    procedure Button7Click(Sender: TObject);
    procedure Button6Click(Sender: TObject);
    procedure imprimir_incapacidad;
    



  PRIVATE
     { PRIVATE DECLARATIONS }
  PUBLIC
    { PUBLIC DECLARATIONS }
  END;

VAR
  FRMINCAPACIDADES: TFRMINCAPACIDADES;
  ENCONTRO : BOOLEAN;
  FECHA_FINAL : TDATETIME;
  EDADAFILIADO : INTEGER;
  ESTADO_INCAPACIDAD : STRING;
  LIQUIDAR : Real;
  NOM1 : STRING;
  NOM2 : STRING;
  APE1 : STRING;
  APE2 : STRING;
IMPLEMENTATION

USES DTMODULO, UDIAGNOSTICOS, UPRINCIPAL, UGLOBAL,UEMPRESAS, UAFILIADOS,
  UPRESTADORES, UPROCESO, AUTOIMPL, UINCAFILIADO, Uplanillacorreciones,
  Ucerincapa;

{$R *.DFM}

PROCEDURE TFRMINCAPACIDADES.FORMCLOSE(SENDER: TOBJECT;
  VAR ACTION: TCLOSEACTION);
BEGIN
ACTION:=CAFREE;
GLPROCESO := '';
FRMPRINCIPAL.SB.PANELS[1].TEXT := 'PROCESO ABIERTO ACTUAL  :'+ GLPROCESO
END;

PROCEDURE TFRMINCAPACIDADES.FORMCREATE(SENDER: TOBJECT);
BEGIN
APPLICATION.ONMESSAGE := APPMESSAGE;
GLPROCESO := 'INCAPACIDADES';
FRMPRINCIPAL.SB.PANELS[1].TEXT := 'PROCESO ABIERTO ACTUAL  :'+ GLPROCESO;
WITH SGDETALLEINC DO
  BEGIN
        CELLS[0,0]:='PERIODO ';
        CELLS[1,0]:='DIAS ';
        CELLS[2,0]:='VALOR ';
        CELLS[3,0]:='DESCONTADA POR';
        CELLS[4,0]:='FECHA  DESCUENTO';
        CELLS[5,0]:='NUMERO  COMPROBANTE';
        CELLS[6,0]:='PERIODO DESCONTADO';
        CELLS[7,0]:='ESTADO';
        CELLS[8,0]:='VALOR DESCONTADO';
        DATAMODULE1.qrydocumentos.Open;
    DTPFECEXPEDICION.DATE := STRTODATE(GLDATE);
    DTPFECINICIACION.DATE := STRTODATE(GLDATE);
    EDTNUMERO.TEXT := '0';
    //EDTNUMERO.SETFOCUS;

    END;

END;

PROCEDURE TFRMINCAPACIDADES.EDTDIASINCAPACIDADKEYPRESS(SENDER: TOBJECT; VAR KEY: CHAR);
BEGIN
 IF (KEY = #13) THEN                            { IF IT'S AN ENTER KEY }
     IF (ACTIVECONTROL IS TEDIT) THEN
        BEGIN
       KEY := #0;                                 { EAT ENTER KEY }
       PERFORM(WM_NEXTDLGCTL, 0, 0);              { MOVE TO NEXT CONTROL }
     END;
IF NOT (KEY IN ['0'..'9',#8])THEN
 BEGIN
 KEY := #0;
 SHOWMESSAGE(LowerCase('DIGITE SOLO NUMEROS'));
 END;
END;

PROCEDURE TFRMINCAPACIDADES.EDTNUMDOCEMPRESAEXIT(SENDER: TOBJECT);
BEGIN
if (trim(EDTNUMDOCEMPRESA.Text) = '') or (trim(EDTNUMDOCEMPRESA.Text) = '0') then
begin
ShowMessage(' Selecione  el tipo de Documento de la Empresa');
Button4.SetFocus;
exit;
end;

 IF (EDTNUMDOCEMPRESA.TEXT >'0') AND  (CBTIPODOCEMPRESA.ITEMINDEX >-1) THEN
  BEGIN
    DATAMODULE1.QRYEMPRESAS.DISABLECONTROLS;
    DATAMODULE1.QRYEMPRESAS.CLOSE;
    DATAMODULE1.QRYEMPRESAS.PARAMBYNAME('PTIPO').VALUE := TRIM(CBTIPODOCEMPRESA.TEXT);
    DATAMODULE1.QRYEMPRESAS.PARAMBYNAME('PNUMERO').VALUE := TRIM(EDTNUMDOCEMPRESA.TEXT);
    DATAMODULE1.QRYEMPRESAS.OPEN;
    DATAMODULE1.QRYEMPRESAS.ENABLECONTROLS;
        IF DATAMODULE1.QRYEMPRESAS.RECORDCOUNT > 0 THEN
        BEGIN
        EDTNOMBREEMPRESA.TEXT := DATAMODULE1.QRYEMPRESASNOM_EMPRESA.VALUE;
        END
        ELSE
        IF DATAMODULE1.QRYEMPRESAS.RECORDCOUNT = 0 THEN
         BEGIN
         SHOWMESSAGE(LowerCase('LA EMPRESA  NO EXISTE VERIFIQUE NUEVAMENTE'));
         CBTIPODOCEMPRESA.ITEMINDEX := -1;
         EDTNUMDOCEMPRESA.TEXT := '';
         Button4.SETFOCUS;
         END;
       END
    ELSE IF EDTNUMDOCEMPRESA.TEXT = '0' THEN
         BEGIN
         SHOWMESSAGE(LowerCase('ESCOJA  EL NUMERO DE  DOCUMENTO  O CON DOBLE CLIK LISTA  LAS  EMPRESAS'));
         Button4.SETFOCUS;
         END;

END;

PROCEDURE TFRMINCAPACIDADES.EDTPROLIQUIDACIONEXIT(SENDER: TOBJECT);
BEGIN
  IF CHPRORROGA.Checked THEN
  BEGIN
    IF STRTOFLOAT(EDIT2.Text) > 90 THEN
       LIQUIDAR := 0.50;
  END;     
        IF RGTIPOINCAPACIDAD.ITEMINDEX = 0 THEN
        BEGIN
        EDTVALORLIQUIDADO.TEXT := FLOATTOSTR(((STRTOINT(EDTPROLIQUIDACION.TEXT)/30)* LIQUIDAR)*(STRTOINT(EDTDIASLIQUIDADOS.TEXT)));
        EDTVALORLIQUIDADO.TEXT := FLOATTOSTR(ROUNDTO(StrToFloat(EDTVALORLIQUIDADO.TEXT),1));
        liquidar_incapacidad;
        END
                ELSE IF RGTIPOINCAPACIDAD.ITEMINDEX = 1 THEN
                BEGIN
                EDTVALORLIQUIDADO.TEXT := FLOATTOSTR((STRTOINT(EDTPROLIQUIDACION.TEXT)/30)* STRTOINT(EDTDIASLIQUIDADOS.TEXT)*LIQUIDAR);
                EDTVALORLIQUIDADO.TEXT := FLOATTOSTR(ROUNDTO(STRTOfloat(EDTVALORLIQUIDADO.TEXT),1));
                liquidar_incapacidad;
                END
                        ELSE IF RGTIPOINCAPACIDAD.ITEMINDEX = 2 THEN
                        BEGIN
                        EDTVALORLIQUIDADO.TEXT := FLOATTOSTR((STRTOINT(EDTPROLIQUIDACION.TEXT)/30)* STRTOINT(EDTDIASLIQUIDADOS.TEXT));
                        EDTVALORLIQUIDADO.TEXT := FLOATTOSTR(ROUNDTO(STRTOfloat(EDTVALORLIQUIDADO.TEXT),1));
                        liquidar_incapacidad;
                        END;

END;

PROCEDURE TFRMINCAPACIDADES.EDTNUMEROEXIT(SENDER: TOBJECT);
BEGIN
IF (trim(EDTNUMERO.TEXT) = '0') or (trim(EDTNUMERO.TEXT) = '') THEN
    BEGIN
     ShowMessage('Digite  el numero de  la inacapcidad');
     EDTNUMERO.SetFocus;
     exit;

    end;

    IF EDTNUMERO.TEXT > '0' THEN
    BEGIN
     EDTNUMERO.TEXT :=FLOATTOSTR(STRTOINT(EDTNUMERO.TEXT));
     DATAMODULE1.QRYINCAPACIDADES.CLOSE;
     DATAMODULE1.QRYINCAPACIDADES.SQL.CLEAR;
     DATAMODULE1.QRYINCAPACIDADES.SQL.ADD('SELECT * FROM INCAPACIDADES WHERE NUM_INCAPACIDAD = :"INCAPACIDAD"');
     DATAMODULE1.QRYINCAPACIDADES.PARAMS[0].ASSTRING := EDTNUMERO.TEXT;
     DATAMODULE1.QRYINCAPACIDADES.OPEN;
         IF DATAMODULE1.QRYINCAPACIDADES.RECORDCOUNT > 0 THEN
        BEGIN
        SHOWMESSAGE(LowerCase('EL NUMERO DE  INCAPACIDAD YA  FUE DIGITADA' + DATETOSTR(DATAMODULE1.QRYINCAPACIDADESFEC_INICIO.VALUE)));
        LIMPIAR;
        ENCONTRO := TRUE;
        btneliminar.Enabled := true;
        REFRESCAR_INCAPACIDAD;

        //EDTPLANILLA.SETFOCUS;
        END
        ELSE IF DATAMODULE1.QRYINCAPACIDADES.RECORDCOUNT = 0 THEN
             BEGIN
             GroupBox2.Enabled := TRUE;
             ENCONTRO := FALSE;

             IF RGTIPOINCAPACIDAD.ITEMINDEX = -1 THEN
               BEGIN
               btneliminar.Enabled := true;
               LIMPIAR;
               RGTIPOINCAPACIDAD.SetFocus;
               END;
             END;
    END;
END;

PROCEDURE TFRMINCAPACIDADES.EDTNUMDOCAFILIADOINEXIT(SENDER: TOBJECT);
BEGIN
        if (Trim(edtnumdocafiliadoin.Text) = '0') or (trim(edtnumdocafiliadoin.Text) = '') then
        begin
        ShowMessage('Digite  el numero de  documento  o Escojalo de  la lista');
        Button5.SetFocus;
        exit;
        end;

    IF (EDTNUMDOCAFILIADOIN.TEXT > '0') AND (CBTIPODOCEMPRESA.ITEMINDEX > -1) THEN
    BEGIN
    DATAMODULE1.QRYAFILIADOS.CLOSE;
  //  DATAMODULE1.QRYAFILIADOS.PREPARE;
    DATAMODULE1.QRYAFILIADOS.SQL.CLEAR;
    DATAMODULE1.QRYAFILIADOS.SQL.ADD('SELECT  TIP_DOCUMENTO_EMP, NUM_DOCUMENTO_EMP,TIP_DOCUMENTO_AFI, NUM_DOCUMENTO_AFI,PRI_APELLIDO,SEG_APELLIDO,PRI_NOMBRE,SEG_NOMBRE,VAL_SUELDO_AFIL,FEC_INGRESO_UNI,FEC_EGRESO_UNI,AFILIADOS_EMPRESAS.COD_ESTADO,FEC_NACIMIENTO,COD_SEXO,COD_MODALIDAD_TRA');
    DATAMODULE1.QRYAFILIADOS.SQL.ADD('FROM AFILIADOS_EMPRESAS,AFILIADOS');
    DATAMODULE1.QRYAFILIADOS.SQL.ADD('WHERE TIP_DOCUMENTO_AFI = TIP_DOCUMENTO AND NUM_DOCUMENTO_AFI = NUM_DOCUMENTO AND TIP_DOCUMENTO_AFI = :"TIPO" AND NUM_DOCUMENTO_AFI = :"NUMERO" AND TIP_DOCUMENTO_EMP = :"TIPOEMP" AND NUM_DOCUMENTO_EMP = :"NUMEROEMP" AND');
    DATAMODULE1.QRYAFILIADOS.SQL.ADD('((FEC_INGRESO_UNI <= :"FECHAIN" ) OR (FEC_INGRESO_UNI <= :"FECHAINI" )) AND ');
    DATAMODULE1.QRYAFILIADOS.SQL.ADD('(((FEC_EGRESO_UNI >= :"FECHAFI" ) OR (FEC_EGRESO_UNI >= :"FECHAIN" )) OR FEC_EGRESO_UNI IS NULL)');
    DATAMODULE1.QRYAFILIADOS.PARAMS[0].ASSTRING := TRIM(FRMINCAPACIDADES.CBTIPODOCAFILIADO.TEXT);
    DATAMODULE1.QRYAFILIADOS.PARAMS[1].ASSTRING := TRIM(FRMINCAPACIDADES.EDTNUMDOCAFILIADOIN.TEXT);
    DATAMODULE1.QRYAFILIADOS.PARAMS[2].ASSTRING := CBTIPODOCEMPRESA.TEXT;
    DATAMODULE1.QRYAFILIADOS.PARAMS[3].ASSTRING := EDTNUMDOCEMPRESA.TEXT;
    DATAMODULE1.QRYAFILIADOS.PARAMS[4].AsDate := STRTODATE('01/' + (FORMATDATETIME('MM',(dtpfecexpedicion.DATE))) + '/' +(FORMATDATETIME('YYYY',(dtpfecexpedicion.DATE))));
    DATAMODULE1.QRYAFILIADOS.PARAMS[5].AsDate := STRTODATE('28/' + (FORMATDATETIME('MM',(dtpfecexpedicion.DATE))) + '/' +(FORMATDATETIME('YYYY',(dtpfecexpedicion.DATE))));
    DATAMODULE1.QRYAFILIADOS.PARAMS[6].AsDate := STRTODATE('01/' + (FORMATDATETIME('MM',(dtpfecexpedicion.DATE))) + '/' +(FORMATDATETIME('YYYY',(dtpfecexpedicion.DATE))));
    DATAMODULE1.QRYAFILIADOS.PARAMS[7].AsDate := STRTODATE('28/' + (FORMATDATETIME('MM',(dtpfecexpedicion.DATE))) + '/' +(FORMATDATETIME('YYYY',(dtpfecexpedicion.DATE))));
    DATAMODULE1.QRYAFILIADOS.OPEN;
        IF DATAMODULE1.QRYAFILIADOS.RECORDCOUNT > 0 THEN
        BEGIN
                EDTSEXO.TEXT := DATAMODULE1.QRYAFILIADOSCOD_SEXO.VALUE ;
                EDADAFILIADO := (FRMPRINCIPAL.EDAD(DATETOSTR(DATAMODULE1.QRYAFILIADOSFEC_NACIMIENTO.VALUE)));
                EDTEDAD.TEXT := INTTOSTR(EDADAFILIADO);
                EDTNOMBREAFILIADO.TEXT := DATAMODULE1.QRYAFILIADOSPRI_APELLIDO.VALUE + ' ' + DATAMODULE1.QRYAFILIADOSSEG_APELLIDO.VALUE + ' ' + DATAMODULE1.QRYAFILIADOSPRI_NOMBRE.VALUE + ' ' + DATAMODULE1.QRYAFILIADOSSEG_NOMBRE.VALUE;
                APE1 := DATAMODULE1.QRYAFILIADOSPRI_APELLIDO.VALUE;
                APE2 := DATAMODULE1.QRYAFILIADOSSEG_APELLIDO.VALUE;
                NOM1 := DATAMODULE1.QRYAFILIADOSPRI_NOMBRE.VALUE;
                NOM2 := DATAMODULE1.QRYAFILIADOSSEG_NOMBRE.VALUE;
                EDTSALARIOBASE.TEXT := FLOATTOSTR(DATAMODULE1.QRYAFILIADOSVAL_SUELDO_AFIL.VALUE);
                edtproliquidacion.TEXT := FLOATTOSTR(DATAMODULE1.QRYAFILIADOSVAL_SUELDO_AFIL.VALUE);
                EDTPROLIQUIDACION.TEXT := FLOATTOSTR(DATAMODULE1.QRYAFILIADOSVAL_SUELDO_AFIL.VALUE);
                  VERIFICAR_CARTERA;
                  IF RGTIPOINCAPACIDAD.ITEMINDEX = 2 THEN
                  BEGIN
                        IF DATAMODULE1.QRYAFILIADOSCOD_SEXO.VALUE = 'M' THEN
                        BEGIN
                        SHOWMESSAGE(LowerCase(' ESTE  USUARIO  NO PUEDE  TENER  UNA LICENCIA DE MATERNIDAD'));
                        LIMPIAR;
                        Button5.SETFOCUS;
                        END

                  END;
               END

                ELSE  IF DATAMODULE1.QRYAFILIADOS.RECORDCOUNT = 0 THEN
                BEGIN
                SHOWMESSAGE(LowerCase('EL USUARIO  NO  EXISTE CON LA  EMPRESA  '+ EDTNOMBREEMPRESA.TEXT  + ' EN EL PERIODO  DE EXPEDICION' + (FORMATDATETIME('MM',(dtpfecexpedicion.DATE))) + '/' +(FORMATDATETIME('YYYY',(dtpfecexpedicion.DATE)))));
                Button5.SETFOCUS;
                EDTNUMDOCAFILIADOIN.TEXT := '';
                CBTIPODOCAFILIADO.ITEMINDEX := -1;
                END;
    END
    ELSE IF EDTNUMDOCAFILIADOIN.TEXT = '0' THEN
         BEGIN
         SHOWMESSAGE(LowerCase('DIGITE  EL NUMERO DE  DOCUMENTO DEL AFILIADO O CON DOBLE CLIK LISTA  LOS  EMPLEADOS  DE LA  EMPRESA'));
         Button5.SETFOCUS;
         END;
END;

PROCEDURE TFRMINCAPACIDADES.EDTCODDIAGNOSTICOEXIT(SENDER: TOBJECT);
 BEGIN
if (trim(EDTCODDIAGNOSTICO.Text) = '')  or (trim(EDTCODDIAGNOSTICO.Text) = '0')then
begin
ShowMessage(LowerCase(' Digite el  código que  origino la  incapacidad  o  dobleckik para  listar los  diagnósticos'));
Button5.SetFocus;
exit;
end;

    IF (EDTCODDIAGNOSTICO.TEXT > '0')  THEN
    BEGIN
        DATAMODULE1.QRYDIAGNOSTICOS.CLOSE;
        DATAMODULE1.QRYDIAGNOSTICOS.PREPARE;
        DATAMODULE1.QRYDIAGNOSTICOS.SQL.CLEAR;
        DATAMODULE1.QRYDIAGNOSTICOS.SQL.ADD('SELECT * FROM DIGNOSTICOS WHERE ((RANGO_SEXO = :"SEXO") OR(RANGO_SEXO = :"SEXOF")) AND ((EDA_MININA <=:"EDAD") AND (EDA_MAXIMA >= :"EDA")) AND  COD_DIAGNOSTICO = :"DIA"');
        IF  EDTSEXO.TEXT = 'M' THEN
         BEGIN
         DATAMODULE1.QRYDIAGNOSTICOS.PARAMS[0].AsString := '1';
         END
         ELSE IF  EDTSEXO.TEXT = 'F' THEN
             BEGIN
             DATAMODULE1.QRYDIAGNOSTICOS.PARAMS[0].AsString := '2';
             END;
        DATAMODULE1.QRYDIAGNOSTICOS.PARAMS[1].AsString := '3';
        DATAMODULE1.QRYDIAGNOSTICOS.PARAMS[2].AsInteger := STRTOINT(EDTEDAD.TEXT);
        DATAMODULE1.QRYDIAGNOSTICOS.PARAMS[3].AsInteger := STRTOINT(EDTEDAD.TEXT);
        DATAMODULE1.QRYDIAGNOSTICOS.PARAMS[4].AsString := EDTCODDIAGNOSTICO.TEXT;
        DATAMODULE1.QRYDIAGNOSTICOS.OPEN;

        IF DATAMODULE1.QRYDIAGNOSTICOS.RECORDCOUNT > 0 THEN
        BEGIN
              EDTNOMBREDIAGNOSTICO.TEXT := DATAMODULE1.QRYDIAGNOSTICOSNOM_DIAGNSOTICO.VALUE;

        END
        ELSE  IF DATAMODULE1.QRYDIAGNOSTICOS.RECORDCOUNT = 0 THEN
              BEGIN
              SHOWMESSAGE(LowerCase('EL CODIGO NO EXISTE  VERIFIQUE  EL LA LISTA'));
              EDTCODDIAGNOSTICO.TEXT := '0';
              Button5.SETFOCUS;
              END;


END;


END;

PROCEDURE TFRMINCAPACIDADES.LIMPIAR;
BEGIN
Edit1.Text := '0';
Edit2.Text := '';
valorletradias.Text := '';
edtfinal.Text := '';
CBTIPODOCAFILIADO.ITEMINDEX := -1;
CBTIPODOCEMPRESA.ITEMINDEX := -1;
EDTNUMDOCAFILIADOIN.TEXT := '0';
EDTNOMBREAFILIADO.TEXT := '0';
EDTNUMDOCEMPRESA.TEXT := '0';
EDTNOMBREEMPRESA.TEXT := '0';
EDTCODDIAGNOSTICO.TEXT := '0';
EDTNOMBREDIAGNOSTICO.TEXT := '';
EDTDIASINCAPACIDAD.TEXT := '0';
EDTDIASLIQUIDADOS.TEXT := '0';
EDTPROLIQUIDACION.TEXT := '0';
EDTVALORLIQUIDADO.TEXT := '0';
RGTIPOINCAPACIDAD.ITEMINDEX := -1;
CHPRORROGA.CHECKED := FALSE;
DTPFECEXPEDICION.DATE := STRTODATE(GLDATE);
DTPFECINICIACION.DATE := (STRTODATE(GLDATE) +1);
EDTSALARIOBASE.TEXT := '0';
    SGDETALLEINC.ROWCOUNT := 1;
    SGDETALLEINC.ROWCOUNT := 2;
    SGDETALLEINC.FIXEDCOLS := 0;
    SGDETALLEINC.FIXEDROWS := 1;

    SGDETALLEINC.CELLS[0,1]:='';
    SGDETALLEINC.CELLS[1,1]:='';
    SGDETALLEINC.CELLS[2,1]:='';
    SGDETALLEINC.CELLS[3,1]:='';
    SGDETALLEINC.CELLS[4,1]:='';
    SGDETALLEINC.CELLS[5,1]:='';
    SGDETALLEINC.CELLS[6,1]:='';
    SGDETALLEINC.CELLS[7,1]:='';
    SGDETALLEINC.CELLS[8,1]:='';

EDTCODPRESTADOR.TEXT := '';
EDTNOMBREPRESTADOR.TEXT := '';
BUTTON2.ENABLED := TRUE;


// DESABILITAR  COMPONENTES

END;

PROCEDURE TFRMINCAPACIDADES.EDTNUMEROENTER(SENDER: TOBJECT);
BEGIN
IF EDTNUMERO.TEXT = '0' THEN
  BEGIN
  LIMPIAR;
  END;
END;

PROCEDURE TFRMINCAPACIDADES.DTPFECINICIACIONEXIT(SENDER: TOBJECT);

BEGIN
IF DTPFECEXPEDICION.DATE < DTPFECINICIACION.DATE THEN
  BEGIN
   SHOWMESSAGE(LowerCase('LA  FECHA  NO PUEDE  SER  MAYOR A LA  FECHA  DE EXPEDICION'));
   DTPFECINICIACION.SETFOCUS;
  END
  ELSE  IF (DTPFECEXPEDICION.DATE - 30)  > DTPFECINICIACION.DATE THEN
         BEGIN
         SHOWMESSAGE(LowerCase('La Incapacidad No se puede Expedir  despues  de 30 dias de inicio'));
         LIMPIAR;
         END
  ELSE
  IF DTPFECEXPEDICION.DATE >= DTPFECINICIACION.DATE THEN
  BEGIN
  INCAPACIDADVIGENTE;
  EDTFINAL.TEXT := DATETOSTR((DTPFECINICIACION.DATE -1) + STRTOINT(EDTDIASINCAPACIDAD.TEXT));

  END;
  END;

PROCEDURE TFRMINCAPACIDADES.PAGOLINCENCIAS;
VAR MES,DIA,ANO : STRING;
PRIMERMES,PRIMERMES1,PRIMERMES2,MESPOS,PRIMERMES3  : INTEGER;
BEGIN
PRIMERMES1 := 0;
PRIMERMES3 := 0;
PRIMERMES2 := 0;
PRIMERMES := 0;

        MES:=(FORMATDATETIME('MM',DTPFECINICIACION.DATE));
        ANO:=(FORMATDATETIME('YYYY',DTPFECINICIACION.DATE));
        DIA:=(FORMATDATETIME('DD',DTPFECINICIACION.DATE));
        IF MES = '12' THEN
          BEGIN
          MES := '01';
          END
          ELSE MES := INTTOSTR(STRTOINT(MES) +1);

          IF (STRTOINT(MES)> 0) AND   (STRTOINT(MES)< 10) THEN
          BEGIN
          MES := '0'+ INTTOSTR(STRTOINT(MES));
          END;

        PRIMERMES := FRMPRINCIPAL.DIASMES(DTPFECINICIACION.DATE)+1 - STRTOINT(FORMATDATETIME('DD',DTPFECINICIACION.DATE));
           IF PRIMERMES <= 0 THEN
               BEGIN
               PRIMERMES := FRMPRINCIPAL.DIASMES(DTPFECINICIACION.DATE);
               MESPOS := STRTOINT(MES);
                  IF (MESPOS > 0) AND (MESPOS < 10) THEN
                  BEGIN
                  MES := '0' + INTTOSTR(MESPOS+1)
                  END
                  ELSE  IF MESPOS >= 10  THEN
                        BEGIN
                        MES := INTTOSTR(MESPOS+1);
                  END;

               END;

           IF PRIMERMES >= STRTOINT(EDTDIASLIQUIDADOS.TEXT) THEN
               BEGIN
                PRIMERMES := STRTOINT(EDTDIASLIQUIDADOS.TEXT);
               END;

IF MES = '12' THEN
           BEGIN
           SGDETALLEINC.CELLS[0,1] :=   '01/12/' + ANO;
           SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
           SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES),0));
           PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
           IF (PRIMERMES1 > 0) AND(PRIMERMES1 <= 30) THEN
             BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,2] :=   '01/01/' + INTTOSTR(STRTOINT(ANO)+1);
                SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                END
                ELSE IF PRIMERMES1 > 30 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        PRIMERMES1 := FRMPRINCIPAL.DIASMES(STRTODATE('01/01/' + INTTOSTR(STRTOINT(ANO)+1)));
                        SGDETALLEINC.CELLS[0,2] :=   '01/01/' + INTTOSTR(STRTOINT(ANO)+1);
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                PRIMERMES2 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1);
                END;
                IF (PRIMERMES2 > 0) AND(PRIMERMES2 <= 30) THEN
                BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,3] :=   '01/02/' + INTTOSTR(STRTOINT(ANO)+1);
                SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                END
                ELSE  IF PRIMERMES2 > 30 THEN
                      BEGIN
                      SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                      SGDETALLEINC.CELLS[0,3] := '01/02/' + INTTOSTR(STRTOINT(ANO)+1);
                      PRIMERMES2 := FRMPRINCIPAL.DIASMES(STRTODATE('01/02/' + INTTOSTR(STRTOINT(ANO)+1)));
                      SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                      SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                      PRIMERMES3 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1 + PRIMERMES2);
                END;
                        IF PRIMERMES3 > 0 THEN
                           BEGIN
                           SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                           SGDETALLEINC.CELLS[0,4] :=   '01/03/' + INTTOSTR(STRTOINT(ANO)+1);
                           SGDETALLEINC.CELLS[1,4] := INTTOSTR(PRIMERMES3);
                           SGDETALLEINC.CELLS[2,4] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES3),0));
                           END;

      END
      ELSE IF MES = '11' THEN
           BEGIN
           SGDETALLEINC.CELLS[0,1] :=   '01/11/' + ANO;
           SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
           SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES),0));
           PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
           IF (PRIMERMES1 > 0) AND(PRIMERMES1 <= 30) THEN
             BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,2] :=   '01/12/' + ANO;
                SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                END
                ELSE IF PRIMERMES1 > 30 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        PRIMERMES1 := FRMPRINCIPAL.DIASMES(STRTODATE('01/12/' + ANO));
                        SGDETALLEINC.CELLS[0,2] :=   '01/12/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                PRIMERMES2 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1);
                END;
                IF (PRIMERMES2 > 0) AND(PRIMERMES2 <= 30) THEN
                BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,3] :=   '01/01/' + INTTOSTR(STRTOINT(ANO)+1);
                SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                END
                ELSE  IF PRIMERMES2 > 30 THEN
                      BEGIN
                      SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                      SGDETALLEINC.CELLS[0,3] := '01/01/' + INTTOSTR(STRTOINT(ANO)+1);
                      PRIMERMES2 := FRMPRINCIPAL.DIASMES(STRTODATE('01/01/' + INTTOSTR(STRTOINT(ANO)+1)));
                      SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                      SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                      PRIMERMES3 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1 + PRIMERMES2);
                END;
                        IF PRIMERMES3 > 0 THEN
                           BEGIN
                           SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                           SGDETALLEINC.CELLS[0,4] :=   '01/02/' + INTTOSTR(STRTOINT(ANO)+1);
                           SGDETALLEINC.CELLS[1,4] := INTTOSTR(PRIMERMES3);
                           SGDETALLEINC.CELLS[2,4] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES3),0));
                           END;

      END
      ELSE IF MES = '10' THEN
           BEGIN
           SGDETALLEINC.CELLS[0,1] :=   '01/10/' + ANO;
           SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
           SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES),0));
           PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
           IF (PRIMERMES1 > 0) AND(PRIMERMES1 <= 30) THEN
             BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,2] :=   '01/11/' + ANO;
                SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                END
                ELSE IF PRIMERMES1 > 30 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        PRIMERMES1 := FRMPRINCIPAL.DIASMES(STRTODATE('01/11/' + ANO));
                        SGDETALLEINC.CELLS[0,2] :=   '01/11/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                PRIMERMES2 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1);
                END;
                IF (PRIMERMES2 > 0) AND(PRIMERMES2 <= 30) THEN
                BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,3] :=    '01/12/' + ANO;
                SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                END
                ELSE  IF PRIMERMES2 > 30 THEN
                      BEGIN
                      SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                      SGDETALLEINC.CELLS[0,3] :=  '01/12/' + ANO;
                      PRIMERMES2 := FRMPRINCIPAL.DIASMES(STRTODATE('01/12/' + ANO));
                      SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));

                      SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                      PRIMERMES3 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1 + PRIMERMES2);
                END;
                        IF PRIMERMES3 > 0 THEN
                           BEGIN
                           SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                           SGDETALLEINC.CELLS[0,4] :=   '01/01/' + INTTOSTR(STRTOINT(ANO)+1);
                           SGDETALLEINC.CELLS[1,4] := INTTOSTR(PRIMERMES3);
                           SGDETALLEINC.CELLS[2,4] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES3),0));
                           END;

      END
      ELSE IF MES = '09' THEN
           BEGIN
           SGDETALLEINC.CELLS[0,1] :=   '01/09/' + ANO;
           SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
           SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES),0));
           PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
           IF (PRIMERMES1 > 0) AND(PRIMERMES1 <= 30) THEN
             BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,2] :=   '01/10/' + ANO;
                SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                END
                ELSE IF PRIMERMES1 > 30 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        PRIMERMES1 := FRMPRINCIPAL.DIASMES(STRTODATE('01/10/' + ANO));
                        SGDETALLEINC.CELLS[0,2] :=   '01/10/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                PRIMERMES2 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1);
                END;
                IF (PRIMERMES2 > 0) AND(PRIMERMES2 <= 30) THEN
                BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,3] :=    '01/11/' + ANO;
                SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                END
                ELSE  IF PRIMERMES2 > 30 THEN
                      BEGIN
                      SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                      SGDETALLEINC.CELLS[0,3] :=  '01/11/' + ANO;
                      PRIMERMES2 := FRMPRINCIPAL.DIASMES(STRTODATE('01/11/' + ANO));
                      SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));

                      SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                      PRIMERMES3 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1 + PRIMERMES2);
                END;
                        IF PRIMERMES3 > 0 THEN
                           BEGIN
                           SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                           SGDETALLEINC.CELLS[0,4] :=   '01/12/' + ANO;
                           SGDETALLEINC.CELLS[1,4] := INTTOSTR(PRIMERMES3);
                           SGDETALLEINC.CELLS[2,4] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES3),0));
                           END;

      END
      ELSE IF MES = '08' THEN
           BEGIN
           SGDETALLEINC.CELLS[0,1] :=   '01/08/' + ANO;
           SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
           SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES),0));
           PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
           IF (PRIMERMES1 > 0) AND(PRIMERMES1 <= 30) THEN
             BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,2] :=   '01/09/' + ANO;
                SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                END
                ELSE IF PRIMERMES1 > 30 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        PRIMERMES1 := FRMPRINCIPAL.DIASMES(STRTODATE('01/09/' + ANO));
                        SGDETALLEINC.CELLS[0,2] :=   '01/09/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                PRIMERMES2 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1);
                END;
                IF (PRIMERMES2 > 0) AND(PRIMERMES2 <= 30) THEN
                BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,3] :=    '01/10/' + ANO;
                SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                END
                ELSE  IF PRIMERMES2 > 30 THEN
                      BEGIN
                      SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                      SGDETALLEINC.CELLS[0,3] :=  '01/10/' + ANO;
                      PRIMERMES2 := FRMPRINCIPAL.DIASMES(STRTODATE('01/10/' + ANO));
                      SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));

                      SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                      PRIMERMES3 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1 + PRIMERMES2);
                END;
                        IF PRIMERMES3 > 0 THEN
                           BEGIN
                           SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                           SGDETALLEINC.CELLS[0,4] :=   '01/11/' + ANO;
                           SGDETALLEINC.CELLS[1,4] := INTTOSTR(PRIMERMES3);
                           SGDETALLEINC.CELLS[2,4] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES3),0));
                           END;

      END
      ELSE IF MES = '07' THEN
           BEGIN
           SGDETALLEINC.CELLS[0,1] :=   '01/07/' + ANO;
           SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
           SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES),0));
           PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
           IF (PRIMERMES1 > 0) AND(PRIMERMES1 <= 30) THEN
             BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,2] :=   '01/08/' + ANO;
                SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                END
                ELSE IF PRIMERMES1 > 30 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        PRIMERMES1 := FRMPRINCIPAL.DIASMES(STRTODATE('01/08/' + ANO));
                        SGDETALLEINC.CELLS[0,2] :=   '01/08/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                PRIMERMES2 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1);
                END;
                IF (PRIMERMES2 > 0) AND(PRIMERMES2 <= 30) THEN
                BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,3] :=    '01/09/' + ANO;
                SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                END
                ELSE  IF PRIMERMES2 > 30 THEN
                      BEGIN
                      SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                      SGDETALLEINC.CELLS[0,3] :=  '01/09/' + ANO;
                      PRIMERMES2 := FRMPRINCIPAL.DIASMES(STRTODATE('01/09/' + ANO));
                      SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));

                      SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                      PRIMERMES3 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1 + PRIMERMES2);
                END;
                        IF PRIMERMES3 > 0 THEN
                           BEGIN
                           SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                           SGDETALLEINC.CELLS[0,4] :=   '01/10/' + ANO;
                           SGDETALLEINC.CELLS[1,4] := INTTOSTR(PRIMERMES3);
                           SGDETALLEINC.CELLS[2,4] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES3),0));
                           END;

      END
      ELSE IF MES = '06' THEN
           BEGIN
           SGDETALLEINC.CELLS[0,1] :=   '01/06/' + ANO;
           SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
           SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES),0));
           PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
           IF (PRIMERMES1 > 0) AND(PRIMERMES1 <= 30) THEN
             BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,2] :=   '01/07/' + ANO;
                SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                END
                ELSE IF PRIMERMES1 > 30 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        PRIMERMES1 := FRMPRINCIPAL.DIASMES(STRTODATE('01/07/' + ANO));
                        SGDETALLEINC.CELLS[0,2] :=   '01/07/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                PRIMERMES2 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1);
                END;
                IF (PRIMERMES2 > 0) AND(PRIMERMES2 <= 30) THEN
                BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,3] :=    '01/08/' + ANO;
                SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                END
                ELSE  IF PRIMERMES2 > 30 THEN
                      BEGIN
                      SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                      SGDETALLEINC.CELLS[0,3] :=  '01/08/' + ANO;
                       PRIMERMES2 := FRMPRINCIPAL.DIASMES(STRTODATE('01/08/' + ANO));
                      SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));

                      SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                      PRIMERMES3 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1 + PRIMERMES2);
                END;
                        IF PRIMERMES3 > 0 THEN
                           BEGIN
                           SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                           SGDETALLEINC.CELLS[0,4] :=   '01/09/' + ANO;
                           SGDETALLEINC.CELLS[1,4] := INTTOSTR(PRIMERMES3);
                           SGDETALLEINC.CELLS[2,4] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES3),0));
                           END;

      END
      ELSE IF MES = '05' THEN
           BEGIN
           SGDETALLEINC.CELLS[0,1] :=   '01/05/' + ANO;
           SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
           SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES),0));
           PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
           IF (PRIMERMES1 > 0) AND(PRIMERMES1 <= 30) THEN
             BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,2] :=   '01/06/' + ANO;
                SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                END
                ELSE IF PRIMERMES1 > 30 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        PRIMERMES1 := FRMPRINCIPAL.DIASMES(STRTODATE('01/06/' + ANO));
                        SGDETALLEINC.CELLS[0,2] :=   '01/06/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                PRIMERMES2 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1);
                END;
                IF (PRIMERMES2 > 0) AND(PRIMERMES2 <= 30) THEN
                BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,3] :=    '01/07/' + ANO;
                SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                END
                ELSE  IF PRIMERMES2 > 30 THEN
                      BEGIN
                      SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                      SGDETALLEINC.CELLS[0,3] :=  '01/07/' + ANO;
                      PRIMERMES2 := FRMPRINCIPAL.DIASMES(STRTODATE('01/07/' + ANO));
                      SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                      SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                      PRIMERMES3 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1 + PRIMERMES2);
                END;
                        IF PRIMERMES3 > 0 THEN
                           BEGIN
                           SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                           SGDETALLEINC.CELLS[0,4] :=   '01/08/' + ANO;
                           SGDETALLEINC.CELLS[1,4] := INTTOSTR(PRIMERMES3);
                           SGDETALLEINC.CELLS[2,4] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES3),0));
                           END;

      END
      ELSE IF MES = '04' THEN
           BEGIN
           SGDETALLEINC.CELLS[0,1] :=   '01/04/' + ANO;
           SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
           SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES),0));
           PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
           IF (PRIMERMES1 > 0) AND(PRIMERMES1 <= 30) THEN
             BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,2] :=   '01/05/' + ANO;
                SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                END
                ELSE IF PRIMERMES1 > 30 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        PRIMERMES1 := FRMPRINCIPAL.DIASMES(STRTODATE('01/05/' + ANO));
                        SGDETALLEINC.CELLS[0,2] :=   '01/05/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                PRIMERMES2 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1);
                END;
                IF (PRIMERMES2 > 0) AND(PRIMERMES2 <= 30) THEN
                BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,3] :=    '01/06/' + ANO;
                SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                END
                ELSE  IF PRIMERMES2 > 30 THEN
                      BEGIN
                      SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                      SGDETALLEINC.CELLS[0,3] :=  '01/06/' + ANO;
                      PRIMERMES2 := FRMPRINCIPAL.DIASMES(STRTODATE('01/06/' + ANO));
                      SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                      SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                      PRIMERMES3 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1 + PRIMERMES2);
                END;
                        IF PRIMERMES3 > 0 THEN
                           BEGIN
                           SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                           SGDETALLEINC.CELLS[0,4] :=   '01/07/' + ANO;
                           SGDETALLEINC.CELLS[1,4] := INTTOSTR(PRIMERMES3);
                           SGDETALLEINC.CELLS[2,4] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES3),0));
                           END;

      END
      ELSE IF MES = '03' THEN
           BEGIN
           SGDETALLEINC.CELLS[0,1] :=   '01/03/' + ANO;
           SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
           SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES),0));
           PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
           IF (PRIMERMES1 > 0) AND(PRIMERMES1 <= 30) THEN
             BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,2] :=   '01/04/' + ANO;
                SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                END
                ELSE IF PRIMERMES1 > 30 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        PRIMERMES1 := FRMPRINCIPAL.DIASMES(STRTODATE('01/04/' + ANO));
                        SGDETALLEINC.CELLS[0,2] :=   '01/04/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                PRIMERMES2 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1);
                END;
                IF (PRIMERMES2 > 0) AND(PRIMERMES2 <= 30) THEN
                BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,3] :=    '01/05/' + ANO;
                SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                END
                ELSE  IF PRIMERMES2 > 30 THEN
                      BEGIN
                      SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                      PRIMERMES2 := FRMPRINCIPAL.DIASMES(STRTODATE('01/05/' + ANO));
                      SGDETALLEINC.CELLS[0,3] :=  '01/05/' + ANO;
                      SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                      SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                      PRIMERMES3 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1 + PRIMERMES2);
                END;
                        IF PRIMERMES3 > 0 THEN
                           BEGIN
                           SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                           SGDETALLEINC.CELLS[0,4] :=   '01/06/' + ANO;
                           SGDETALLEINC.CELLS[1,4] := INTTOSTR(PRIMERMES3);
                           SGDETALLEINC.CELLS[2,4] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES3),0));
                           END;

      END
      ELSE IF MES = '02' THEN
           BEGIN
           SGDETALLEINC.CELLS[0,1] :=   '01/02/' + ANO;
           SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
           SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES),0));
           PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
           IF (PRIMERMES1 > 0) AND(PRIMERMES1 <= 30) THEN
             BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,2] :=   '01/03/' + ANO;
                SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                END
                ELSE IF PRIMERMES1 > 30 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        PRIMERMES1 := FRMPRINCIPAL.DIASMES(STRTODATE('01/03/' + ANO));
                        SGDETALLEINC.CELLS[0,2] :=   '01/03/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                PRIMERMES2 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1);
                END;
                IF (PRIMERMES2 > 0) AND(PRIMERMES2 <= 30) THEN
                BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,3] :=    '01/04/' + ANO;
                SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                END
                ELSE  IF PRIMERMES2 > 30 THEN
                      BEGIN
                      SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                      SGDETALLEINC.CELLS[0,3] :=  '01/04/' + ANO;
                      PRIMERMES2 := FRMPRINCIPAL.DIASMES(STRTODATE('01/04/' + ANO));
                      SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                      SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                      PRIMERMES3 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1 + PRIMERMES2);
                END;
                        IF PRIMERMES3 > 0 THEN
                           BEGIN
                           SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                           SGDETALLEINC.CELLS[0,4] :=   '01/05/' + ANO;
                           SGDETALLEINC.CELLS[1,4] := INTTOSTR(PRIMERMES3);
                           SGDETALLEINC.CELLS[2,4] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES3),0));
                           END;

      END
      ELSE IF MES = '01' THEN
           BEGIN
           SGDETALLEINC.CELLS[0,1] :=   '01/01/' + INTTOSTR(STRTOINT(ANO)+1);
           SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
           SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES),0));
           PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
           IF (PRIMERMES1 > 0) AND(PRIMERMES1 <= 30) THEN
             BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,2] :=   '01/02/' + INTTOSTR(STRTOINT(ANO)+1);
                SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                END
                ELSE IF PRIMERMES1 > 30 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        PRIMERMES1 := FRMPRINCIPAL.DIASMES(STRTODATE('01/02/' + INTTOSTR(STRTOINT(ANO)+1)));
                        SGDETALLEINC.CELLS[0,2] :=   '01/02/' + INTTOSTR(STRTOINT(ANO)+1);
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES1),0));
                PRIMERMES2 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1);
                END;
                IF (PRIMERMES2 > 0) AND(PRIMERMES2 <= 30) THEN
                BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                SGDETALLEINC.CELLS[0,3] :=    '01/03/' + ANO;
                SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                END
                ELSE  IF PRIMERMES2 > 30 THEN
                      BEGIN
                      SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                      PRIMERMES2 := FRMPRINCIPAL.DIASMES(STRTODATE('01/03/' + INTTOSTR(STRTOINT(ANO)+1)));
                      SGDETALLEINC.CELLS[0,3] :=  '01/03/' + INTTOSTR(STRTOINT(ANO)+1);
                      SGDETALLEINC.CELLS[2,3] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES2),0));
                      SGDETALLEINC.CELLS[1,3] := INTTOSTR(PRIMERMES2);
                      PRIMERMES3 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES + PRIMERMES1 + PRIMERMES2);
                END;
                        IF PRIMERMES3 > 0 THEN
                           BEGIN
                           SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                           SGDETALLEINC.CELLS[0,4] :=   '01/04/' + INTTOSTR(STRTOINT(ANO)+1);
                           SGDETALLEINC.CELLS[1,4] := INTTOSTR(PRIMERMES3);
                           SGDETALLEINC.CELLS[2,4] := FLOATTOSTR(ROUNDTO((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT)* PRIMERMES3),0));
                           END;
      END;


 END;

PROCEDURE TFRMINCAPACIDADES.EDTDIASINCAPACIDADEXIT(SENDER: TOBJECT);
var dias : integer;
BEGIN
        IF EDTDIASINCAPACIDAD.TEXT > '0' THEN
        BEGIN
                EDTDIASINCAPACIDAD.TEXT :=   INTTOSTR(STRTOINT(EDTDIASINCAPACIDAD.TEXT));
                IF RGTIPOINCAPACIDAD.ITEMINDEX <= 1 THEN
                BEGIN
                IF STRTOINT(EDTDIASINCAPACIDAD.TEXT) > 30 THEN
                BEGIN
                SHOWMESSAGE(LowerCase(' LOS  DIAS  DE  INCAPACIDAD GENERAL  NO PUDE  SER  MAYOR  DE 30 DIAS'));
                END
                ELSE
                begin
                valorletradias.Text := FRMPRINCIPAL.pasarletras(StrToInt64(edtdiasincapacidad.text));
                EDTFINAL.TEXT := DATETOSTR((DTPFECINICIACION.DATE -1) + STRTOINT(EDTDIASINCAPACIDAD.TEXT));
                      LIQUIDAR := 0.66667;
                      if chprorroga.Checked = true then
                      begin
                       if ((STRTOINT(DATAMODULE1.qryincapacidadesTOT_DIAS_PRORROGA.VALUE) >= 90) AND (STRTOINT(DATAMODULE1.qryincapacidadesTOT_DIAS_PRORROGA.VALUE) <= 120)) then
                       begin
                       SHOWMESSAGE(LowerCase('EL USUARIO  COMPLETO MAS  DE 90 DIAS  EN INCAPACIDAD SERA LIQUIDADA POR 50% DEL SALARIO BASICO'));
                       LIQUIDAR := 0.50;
                       end
                       ELSE
                           if STRTOINT(DATAMODULE1.qryincapacidadesTOT_DIAS_PRORROGA.VALUE) > 120 then
                           begin
                           SHOWMESSAGE(LowerCase('EL USUARIO  COMPLETO MAS  DE 135 DIAS  EN INCAPACIDAD  DEBE GENERAR UN AVISO AL FONDO DE PENSIONES'));
                           LIQUIDAR := 0.50;
                           end
                           ELSE
                               if STRTOINT(DATAMODULE1.qryincapacidadesTOT_DIAS_PRORROGA.VALUE) <= 90 then
                               begin
                               LIQUIDAR := 0.66667;
                               end;



                      Edit2.Text := inttostr((strtoint(DATAMODULE1.qryincapacidadesTOT_DIAS_PRORROGA.VALUE))+(strtoint(edtdiasincapacidad.Text)));
                      end
                      else
                      Edit2.Text := edtdiasincapacidad.text

                end;
                END
                ELSE IF RGTIPOINCAPACIDAD.ITEMINDEX = 2 THEN
                BEGIN
                IF STRTOINT(EDTDIASINCAPACIDAD.TEXT) > 84 THEN
                BEGIN
                SHOWMESSAGE(LowerCase(' LOS  DIAS  DE  LICENCIA DE MATERNIDAD  NO PUDE  SER  MAYOR  DE 84 DIAS'));
                END
                ELSE IF STRTOINT(EDTDIASINCAPACIDAD.TEXT) <= 84 THEN
                      BEGIN
                                      valorletradias.Text := FRMPRINCIPAL.pasarletras(StrToInt64(edtdiasincapacidad.text));
                      EDTFINAL.TEXT := DATETOSTR((DTPFECINICIACION.DATE -1) + STRTOINT(EDTDIASINCAPACIDAD.TEXT));

                      END;

                END;
        END
      ELSE
      SHOWMESSAGE(LowerCase('DIGITE  EL NUMERO DE DIAS  DE LA  INCAPACIDAD'));
     DIASLIQUIDADOS;
END;

PROCEDURE TFRMINCAPACIDADES.EDTNUMDOCAFILIADOINCLICK(SENDER: TOBJECT);
BEGIN

IF EDTNUMDOCEMPRESA.TEXT = '0' THEN
  BEGIN
  SHOWMESSAGE(LowerCase(' DEBE  SELECIONAR LA  EMPRESA PARA  CONTINUAR'))
  END
  ELSE IF EDTNUMDOCEMPRESA.TEXT = '' THEN
  BEGIN
  SHOWMESSAGE(LowerCase(' DEBE  SELECIONAR LA  EMPRESA PARA  CONTINUAR'))
  END;
END;

PROCEDURE TFRMINCAPACIDADES.RGTIPOINCAPACIDADEXIT(SENDER: TOBJECT);
BEGIN
if RGTIPOINCAPACIDAD.Text = '' then
begin
ShowMessage(LowerCase('SELECIONE  EL TIPO DE  INCAPACIDAD'));
RGTIPOINCAPACIDAD.SetFocus;
exit;
end;
IF EDTDIASINCAPACIDAD.TEXT = '0' THEN
 BEGIN
IF  RGTIPOINCAPACIDAD.ITEMINDEX <= 1 THEN
  BEGIN
  EDTDIASINCAPACIDAD.TEXT := '30';
  END
  ELSE IF  RGTIPOINCAPACIDAD.ITEMINDEX = 2 THEN
          BEGIN
          EDTDIASINCAPACIDAD.TEXT := '84';
          EDTCODDIAGNOSTICO.TEXT := '6500';
          chprorroga.Enabled := false;
          Edit1.Enabled := false;
          
          END;
    END;
END;

PROCEDURE TFRMINCAPACIDADES.EDTNUMDOCEMPRESACHANGE(SENDER: TOBJECT);
BEGIN
IF EDTNUMDOCEMPRESA.TEXT > '0' THEN

BEGIN
IF RGTIPOINCAPACIDAD.ITEMINDEX = -1 THEN
  BEGIN
  SHOWMESSAGE(LowerCase('ESCOJA  EL  TIPO DE  INCAPACIDAD'));
  RGTIPOINCAPACIDAD.SETFOCUS;
  END;
END;



END;

PROCEDURE TFRMINCAPACIDADES.EDTCODPRESTADOREXIT(SENDER: TOBJECT);
BEGIN
IF EDTCODPRESTADOR.TEXT >'0' THEN
   BEGIN
        DATAMODULE1.QRYPRESTADORES.CLOSE;
        DATAMODULE1.QRYPRESTADORES.PREPARE;
        DATAMODULE1.QRYPRESTADORES.SQL.CLEAR;
        DATAMODULE1.QRYPRESTADORES.SQL.ADD('SELECT * FROM PRESTADORES WHERE COD_PRESTADOR = :"CODIGO"');
        DATAMODULE1.QRYPRESTADORES.PARAMS[0].ASSTRING := TRIM(EDTCODPRESTADOR.TEXT);
        DATAMODULE1.QRYPRESTADORES.OPEN;

        IF DATAMODULE1.QRYPRESTADORES.RECORDCOUNT > 0 THEN
        BEGIN
        EDTNOMBREPRESTADOR.TEXT := DATAMODULE1.QRYPRESTADORESMON_PRESTADOR.VALUE;
        EDTNOMBREPRESTADOR.ENABLED := FALSE;
        EDTSALARIOBASE.SETFOCUS;
        END
        ELSE IF DATAMODULE1.QRYPRESTADORES.RECORDCOUNT = 0 THEN
                BEGIN
                EDTNOMBREPRESTADOR.ENABLED := TRUE;
                END;


    END
    ELSE IF EDTCODPRESTADOR.TEXT = '0' THEN
    BEGIN
    SHOWMESSAGE(LowerCase('DIGITE  CODIGO DEL PRESTADOR O DOBLE CLIK PARA LISTAR LOS  PRESTADORES SE  SALUD'));
    EDTCODPRESTADOR.SETFOCUS;
    END;


END;

PROCEDURE TFRMINCAPACIDADES.REFRESCAR_INCAPACIDAD;
VAR I : INTEGER;
BEGIN
        EDTNUMERO.TEXT := DATAMODULE1.QRYINCAPACIDADESNUM_INCAPACIDAD.VALUE;

        IF DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('TIP_INCAPACIDAD').VALUE = 'EGA' THEN
           BEGIN
           RGTIPOINCAPACIDAD.ITEMINDEX := 0;
           END
           ELSE IF DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('TIP_INCAPACIDAD').VALUE = 'EGH' THEN
                BEGIN
                RGTIPOINCAPACIDAD.ITEMINDEX := 1;
                END
                ELSE IF DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('TIP_INCAPACIDAD').VALUE = 'MAT' THEN
                     BEGIN
                     RGTIPOINCAPACIDAD.ITEMINDEX := 2;
                     END;
        DTPFECEXPEDICION.DATE := DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('FEC_EXPEDICION').VALUE;
        IF DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('TIP_DOCEMPRESA').VALUE = 'CC' THEN
            BEGIN
             CBTIPODOCEMPRESA.ITEMINDEX := 0;
             END
             ELSE IF DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('TIP_DOCEMPRESA').VALUE = 'NIT' THEN
                  BEGIN
                  CBTIPODOCEMPRESA.ITEMINDEX := 1;
                  END
                  ELSE  IF DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('TIP_DOCEMPRESA').VALUE = 'CE' THEN
                        BEGIN
                        CBTIPODOCEMPRESA.ITEMINDEX := 2;
                        END
                        ELSE    IF DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('TIP_DOCEMPRESA').VALUE = 'TI' THEN
                                BEGIN
                                CBTIPODOCEMPRESA.ITEMINDEX := 3;
                                END;


        EDTNUMDOCEMPRESA.TEXT := DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('NUM_DOCEMPRESA').VALUE;
        IF EDTNUMDOCEMPRESA.TEXT >'0' THEN
        BEGIN
          DATAMODULE1.QRYEMPRESAS.DISABLECONTROLS;
          DATAMODULE1.QRYEMPRESAS.CLOSE;
          DATAMODULE1.QRYEMPRESAS.PARAMBYNAME('PTIPO').VALUE := TRIM(CBTIPODOCEMPRESA.TEXT);
          DATAMODULE1.QRYEMPRESAS.PARAMBYNAME('PNUMERO').VALUE := TRIM(EDTNUMDOCEMPRESA.TEXT);
          DATAMODULE1.QRYEMPRESAS.OPEN;
          DATAMODULE1.QRYEMPRESAS.ENABLECONTROLS;
                IF DATAMODULE1.QRYEMPRESAS.RECORDCOUNT > 0 THEN
                BEGIN
                EDTNOMBREEMPRESA.TEXT := DATAMODULE1.QRYEMPRESASNOM_EMPRESA.VALUE;
                END;
        END;
               EDTCODDIAGNOSTICO.TEXT := DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('COD_DIAGNOSTICO').VALUE;
                IF EDTCODDIAGNOSTICO.TEXT > '0' THEN
                BEGIN
                DATAMODULE1.QRYDIAGNOSTICOS.CLOSE;
                DATAMODULE1.QRYDIAGNOSTICOS.PREPARE;
                DATAMODULE1.QRYDIAGNOSTICOS.SQL.CLEAR;
                DATAMODULE1.QRYDIAGNOSTICOS.SQL.ADD('SELECT * FROM DIGNOSTICOS WHERE COD_DIAGNOSTICO = :"DIA"');
                DATAMODULE1.QRYDIAGNOSTICOS.PARAMS[0].ASSTRING := EDTCODDIAGNOSTICO.TEXT;
                DATAMODULE1.QRYDIAGNOSTICOS.OPEN;

                IF DATAMODULE1.QRYDIAGNOSTICOS.RECORDCOUNT > 0 THEN
                   BEGIN
                   EDTNOMBREDIAGNOSTICO.TEXT := DATAMODULE1.QRYDIAGNOSTICOSNOM_DIAGNSOTICO.VALUE;
                   END;
                END;




                IF  DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('AFI_TIPO_DOC').VALUE =  'CC' THEN
                BEGIN
                CBTIPODOCAFILIADO.ITEMINDEX := 0;
                END
                ELSE   IF  DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('AFI_TIPO_DOC').VALUE =  'CE' THEN
                        BEGIN
                        CBTIPODOCAFILIADO.ITEMINDEX := 1;
                        END
                        ELSE IF  DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('AFI_TIPO_DOC').VALUE =  'TI' THEN
                                BEGIN
                                CBTIPODOCAFILIADO.ITEMINDEX := 2;
                                END;

        EDTNUMDOCAFILIADOIN.TEXT := DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('AFI_NUMERO_DOC').VALUE;

                IF EDTNUMDOCAFILIADOIN.TEXT > '0' THEN
                BEGIN
                DATAMODULE1.QRYAFILIADOS.CLOSE;
                DATAMODULE1.QRYAFILIADOS.PREPARE;
                DATAMODULE1.QRYAFILIADOS.SQL.CLEAR;
                DATAMODULE1.QRYAFILIADOS.SQL.ADD('SELECT  TIP_DOCUMENTO_EMP, NUM_DOCUMENTO_EMP,TIP_DOCUMENTO_AFI, NUM_DOCUMENTO_AFI,PRI_APELLIDO,SEG_APELLIDO,PRI_NOMBRE,SEG_NOMBRE,VAL_SUELDO_AFIL,FEC_INGRESO_UNI,FEC_EGRESO_UNI,AFILIADOS_EMPRESAS.COD_ESTADO,FEC_NACIMIENTO,COD_SEXO,COD_MODALIDAD_TRA');
                DATAMODULE1.QRYAFILIADOS.SQL.ADD('FROM AFILIADOS_EMPRESAS,AFILIADOS');
                DATAMODULE1.QRYAFILIADOS.SQL.ADD('WHERE TIP_DOCUMENTO_AFI = TIP_DOCUMENTO AND NUM_DOCUMENTO_AFI = NUM_DOCUMENTO AND TIP_DOCUMENTO_AFI = :"NIT" AND NUM_DOCUMENTO_AFI = :"DOCUMENTO"');
                DATAMODULE1.QRYAFILIADOS.PARAMS[0].ASSTRING := TRIM(FRMINCAPACIDADES.CBTIPODOCAFILIADO.TEXT);
                DATAMODULE1.QRYAFILIADOS.PARAMS[1].ASSTRING := TRIM(FRMINCAPACIDADES.EDTNUMDOCAFILIADOIN.TEXT);
                DATAMODULE1.QRYAFILIADOS.OPEN;

                IF DATAMODULE1.QRYAFILIADOS.RECORDCOUNT > 0 THEN
                   BEGIN
                    EDTNOMBREAFILIADO.TEXT := DATAMODULE1.QRYAFILIADOSPRI_APELLIDO.VALUE + ' ' + DATAMODULE1.QRYAFILIADOSSEG_APELLIDO.VALUE + ' ' + DATAMODULE1.QRYAFILIADOSPRI_NOMBRE.VALUE + ' ' + DATAMODULE1.QRYAFILIADOSSEG_NOMBRE.VALUE;
                    APE1 := DATAMODULE1.QRYAFILIADOSPRI_APELLIDO.VALUE;
                    APE2 := DATAMODULE1.QRYAFILIADOSSEG_APELLIDO.VALUE;
                    NOM1 := DATAMODULE1.QRYAFILIADOSPRI_NOMBRE.VALUE;
                    NOM2 := DATAMODULE1.QRYAFILIADOSSEG_NOMBRE.VALUE;
                   EDTSEXO.TEXT := DATAMODULE1.QRYAFILIADOSCOD_SEXO.VALUE ;
                   EDADAFILIADO := (FRMPRINCIPAL.EDAD(DATETOSTR(DATAMODULE1.QRYAFILIADOSFEC_NACIMIENTO.VALUE)));
                   EDTEDAD.TEXT := INTTOSTR(EDADAFILIADO);
                   END;
                END;
        EDTCODPRESTADOR.TEXT := DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('COD_PRESTADOR').VALUE;
        EDTNOMBREPRESTADOR.TEXT := DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('NOM_PRESTADOR').VALUE;
        EDTDIASINCAPACIDAD.TEXT := DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('DIA_INCAPACIDAD').VALUE;
        EDTDIASLIQUIDADOS.TEXT := DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('DIA_LIQUIDADOS').VALUE;
        DTPFECINICIACION.DATE := DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('FEC_INICIO').VALUE;
                        valorletradias.Text := FRMPRINCIPAL.pasarletras(StrToInt64(edtdiasincapacidad.text));
        IF DATAMODULE1.QRYINCAPACIDADESFEC_TERMINACION.VALUE <> NULL THEN
         BEGIN
         EDTFINAL.TEXT := DATETOSTR(DATAMODULE1.QRYINCAPACIDADESFEC_TERMINACION.VALUE);
         END
         ELSE
         EDTFINAL.TEXT := DATETOSTR((DTPFECINICIACION.DATE -1) + STRTOINT(EDTDIASINCAPACIDAD.TEXT));
        IF DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('PRO_INCAPACIDAD').VALUE = 'S' THEN
           BEGIN
            CHPRORROGA.CHECKED := TRUE;
            Edit1.TEXT := DATAMODULE1.qryincapacidadesNO_PRORROGA.VALUE;
            Edit2.TEXT := DATAMODULE1.qryincapacidadesTOT_DIAS_PRORROGA.VALUE;
            END
            ELSE IF DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('PRO_INCAPACIDAD').VALUE = 'N' THEN
                 BEGIN
                 CHPRORROGA.CHECKED := FALSE;
                 Edit1.TEXT := '0';
                 Edit2.TEXT := DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('DIA_INCAPACIDAD').VALUE;
                 END;

        EDTSALARIOBASE.TEXT := DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('SAL_BASE').VALUE;
        EDTPROLIQUIDACION.TEXT := DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('PRO_SALARIO_LIQUI').VALUE;
        EDTVALORLIQUIDADO.TEXT := DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('VAL_INCAPACIDAD').VALUE;

             DATAMODULE1.QRYDETINCAPACIDAD.CLOSE;
             DATAMODULE1.QRYDETINCAPACIDAD.SQL.CLEAR;
             DATAMODULE1.QRYDETINCAPACIDAD.SQL.ADD('SELECT * FROM DET_INCAPACIDAD WHERE NUM_INCAPACIDAD = :"INCAP" ORDER BY FEC_PAGO_INCAP ');
             DATAMODULE1.QRYDETINCAPACIDAD.PARAMS[0].ASSTRING := EDTNUMERO.TEXT;
             DATAMODULE1.QRYDETINCAPACIDAD.OPEN;
             IF DATAMODULE1.QRYDETINCAPACIDAD.RECORDCOUNT > 0 THEN
              BEGIN
                 FOR I:= 1 TO DATAMODULE1.QRYDETINCAPACIDAD.RECORDCOUNT DO
                 BEGIN
                    IF I > 1 THEN
                    BEGIN
                    SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                    SGDETALLEINC.CELLS[0,I] := DATAMODULE1.QRYDETINCAPACIDAD.FIELDBYNAME('PER_PAGO_INCAP').VALUE;
                    SGDETALLEINC.CELLS[1,I] := DATAMODULE1.QRYDETINCAPACIDAD.FIELDBYNAME('DIA_PAGAR_INCAP').VALUE;
                    SGDETALLEINC.CELLS[2,I] := DATAMODULE1.QRYDETINCAPACIDAD.FIELDBYNAME('VAL_PAGAR_INCAP').VALUE;
                    IF DATAMODULE1.qrydetincapacidadTIP_PAGO_INCAP.VALUE <> '' THEN
                     BEGIN
                        GroupBox2.Enabled := FALSE;
                        BUTTON2.ENABLED := FALSE;
                        btneliminar.Enabled := false;
                        SGDETALLEINC.CELLS[3,I] := DATAMODULE1.qrydetincapacidadTIP_PAGO_INCAP.VALUE;
                        SGDETALLEINC.CELLS[4,I] := DATETOSTR(DATAMODULE1.QRYDETINCAPACIDADFEC_PAGO_INCAP.VALUE);
                        SGDETALLEINC.CELLS[5,I] := DATAMODULE1.QRYDETINCAPACIDADNUM_COMPROBANTE.VALUE;
                        SGDETALLEINC.CELLS[6,I] := DATAMODULE1.QRYDETINCAPACIDADPER_PRESENTADO.VALUE;
                        SGDETALLEINC.CELLS[7,I] := DATAMODULE1.QRYDETINCAPACIDADEST_DET_PLANILLA.VALUE;
                        SGDETALLEINC.CELLS[8,I] := FLOATTOSTR(DATAMODULE1.QRYDETINCAPACIDADVAL_DESCONTADO.VALUE);
                    END;
                    DATAMODULE1.QRYDETINCAPACIDAD.FINDNEXT;
                    END
                    ELSE IF I = 1 THEN
                    BEGIN
                    SGDETALLEINC.CELLS[0,I] := DATAMODULE1.QRYDETINCAPACIDAD.FIELDBYNAME('PER_PAGO_INCAP').VALUE;
                    SGDETALLEINC.CELLS[1,I] := DATAMODULE1.QRYDETINCAPACIDAD.FIELDBYNAME('DIA_PAGAR_INCAP').VALUE;
                    SGDETALLEINC.CELLS[2,I] := DATAMODULE1.QRYDETINCAPACIDAD.FIELDBYNAME('VAL_PAGAR_INCAP').VALUE;
                   IF DATAMODULE1.QRYDETINCAPACIDADTIP_PAGO_INCAP.VALUE <> '' THEN
                     BEGIN
                        SHOWMESSAGE(LowerCase(' LA  ' + RGTIPOINCAPACIDAD.TEXT +' NO SE  PUEDE MODIFICAR'));
                        GroupBox2.Enabled := FALSE;
                        btneliminar.Enabled := false;
                        BUTTON2.ENABLED := FALSE;
                        SGDETALLEINC.CELLS[3,I] := DATAMODULE1.QRYDETINCAPACIDADTIP_PAGO_INCAP.VALUE;
                        SGDETALLEINC.CELLS[4,I] := DATETOSTR(DATAMODULE1.QRYDETINCAPACIDADFEC_PAGO_INCAP.VALUE);
                        SGDETALLEINC.CELLS[5,I] := DATAMODULE1.QRYDETINCAPACIDADNUM_COMPROBANTE.VALUE;
                        SGDETALLEINC.CELLS[6,I] := DATAMODULE1.QRYDETINCAPACIDADPER_PRESENTADO.VALUE;
                        SGDETALLEINC.CELLS[7,I] := DATAMODULE1.QRYDETINCAPACIDADEST_DET_PLANILLA.VALUE;
                        SGDETALLEINC.CELLS[8,I] := FLOATTOSTR(DATAMODULE1.QRYDETINCAPACIDADVAL_DESCONTADO.VALUE);
                    END;
                    DATAMODULE1.QRYDETINCAPACIDAD.FINDNEXT;
                    END;
                 END;

        END;
END;

PROCEDURE TFRMINCAPACIDADES.BUTTON3CLICK(SENDER: TOBJECT);
BEGIN
EDTNUMERO.TEXT := '0';
btneliminar.Enabled := true;

GroupBox2.Enabled := TRUE;
LIMPIAR;
END;

PROCEDURE TFRMINCAPACIDADES.DIASLIQUIDADOS;
BEGIN

        IF RGTIPOINCAPACIDAD.ITEMINDEX = 0 THEN
        BEGIN

          IF CHPRORROGA.CHECKED = FALSE THEN
           BEGIN
           EDTDIASLIQUIDADOS.TEXT := FLOATTOSTR(STRTOINT(EDTDIASINCAPACIDAD.TEXT)-3);
            IF  STRTOINT(EDTDIASLIQUIDADOS.TEXT) <= 0 THEN
              BEGIN
              EDTDIASLIQUIDADOS.TEXT := '0';
             END;
           END
           ELSE IF CHPRORROGA.CHECKED = TRUE THEN
                BEGIN
                EDTDIASLIQUIDADOS.TEXT := FLOATTOSTR(STRTOINT(EDTDIASINCAPACIDAD.TEXT));
                END;
          END
                ELSE IF RGTIPOINCAPACIDAD.ITEMINDEX = 1 THEN
                BEGIN
                EDTDIASLIQUIDADOS.TEXT := EDTDIASINCAPACIDAD.TEXT;
                END
                        ELSE IF RGTIPOINCAPACIDAD.ITEMINDEX = 2 THEN
                        BEGIN
                        EDTDIASLIQUIDADOS.TEXT := EDTDIASINCAPACIDAD.TEXT;
                        END;

END;

PROCEDURE TFRMINCAPACIDADES.PAGOEFERMEDADGENERAL;
VAR MES,DIA,ANO : STRING;
PRIMERMES,PRIMERMES3,PRIMERMES1,PRIMERMES2,MESPOS : INTEGER;
BEGIN
PRIMERMES := 0;
        MES:=(FORMATDATETIME('MM',DTPFECINICIACION.DATE));

        ANO:=(FORMATDATETIME('YYYY',DTPFECINICIACION.DATE));
        DIA:=(FORMATDATETIME('DD',DTPFECINICIACION.DATE));
           IF EDTDIASINCAPACIDAD.TEXT <> EDTDIASLIQUIDADOS.TEXT THEN
           BEGIN
           IF MES = '12' THEN
          BEGIN
          MES := '01';
          END
          ELSE MES := INTTOSTR(STRTOINT(MES) +1);

          IF (STRTOINT(MES)> 0) AND   (STRTOINT(MES)< 10) THEN
          BEGIN
          MES := '0'+ INTTOSTR(STRTOINT(MES));
          END;


           PRIMERMES := FRMPRINCIPAL.DIASMES(DTPFECINICIACION.DATE)-2 - STRTOINT(FORMATDATETIME('DD',DTPFECINICIACION.DATE));
               IF PRIMERMES <= 0 THEN
               BEGIN
               PRIMERMES := STRTOINT(EDTDIASLIQUIDADOS.TEXT);
               MESPOS := STRTOINT(MES);

               END;
           END
           ELSE IF EDTDIASINCAPACIDAD.TEXT = EDTDIASLIQUIDADOS.TEXT THEN
                BEGIN
                PRIMERMES := FRMPRINCIPAL.DIASMES(DTPFECINICIACION.DATE)+1 - STRTOINT(FORMATDATETIME('DD',DTPFECINICIACION.DATE));
                IF PRIMERMES <= 0 THEN
               BEGIN
                 PRIMERMES := STRTOINT(EDTDIASLIQUIDADOS.TEXT);
                 MESPOS := STRTOINT(MES);
                 END;
             END;
        IF PRIMERMES >= STRTOINT(EDTDIASLIQUIDADOS.TEXT) THEN
           BEGIN
           PRIMERMES := STRTOINT(EDTDIASLIQUIDADOS.TEXT);
        END;

        IF MES = '12' THEN
           BEGIN
           SGDETALLEINC.CELLS[0,1] :=   '01/12/' + ANO;
           SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
           SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES),0));
           PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
           IF PRIMERMES1 > 0 THEN
                BEGIN
                SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT + 1;
                SGDETALLEINC.CELLS[0,2] :=   '01/01/' + INTTOSTR(STRTOINT(ANO)+1);
                SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES1),0));
                END;

          END
          ELSE IF MES = '01' THEN
                BEGIN
                SGDETALLEINC.CELLS[0,1] :=   '01/01/' + ANO;
                SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
                SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES),0));
                PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
                IF PRIMERMES1 > 0 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        SGDETALLEINC.CELLS[0,2] :=   '01/02/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES1),0));
                        END;

                END
                ELSE IF MES = '02' THEN
                BEGIN
                SGDETALLEINC.CELLS[0,1] :=   '01/02/' + ANO;
                SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
                SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES),0));
                PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
                IF PRIMERMES1 > 0 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        SGDETALLEINC.CELLS[0,2] :=   '01/03/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES1),0));
                        END;
                END
                ELSE IF MES = '03' THEN
                BEGIN
                SGDETALLEINC.CELLS[0,1] :=   '01/03/' + ANO;
                SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
                SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES),0));
                PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
                IF PRIMERMES1 > 0 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        SGDETALLEINC.CELLS[0,2] :=   '01/04/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES1),0));
                        END;
                END
                ELSE IF MES = '04' THEN
                BEGIN
                SGDETALLEINC.CELLS[0,1] :=   '01/04/' + ANO;
                SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
                SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES),0));
                PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
                IF PRIMERMES1 > 0 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        SGDETALLEINC.CELLS[0,2] :=   '01/05/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES1),0));
                        END;
                END
                ELSE IF MES = '05' THEN
                BEGIN
                SGDETALLEINC.CELLS[0,1] :=   '01/05/' + ANO;
                SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
                SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES),0));
                PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
                IF PRIMERMES1 > 0 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        SGDETALLEINC.CELLS[0,2] :=   '01/06/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES1),0));
                        END;
                END
                ELSE IF MES = '06' THEN
                BEGIN
                SGDETALLEINC.CELLS[0,1] :=   '01/06/' + ANO;
                SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
                SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES),0));
                PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
                IF PRIMERMES1 > 0 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        SGDETALLEINC.CELLS[0,2] :=   '01/07/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES1),0));
                        END;
                END
                ELSE IF MES = '07' THEN
                BEGIN
                SGDETALLEINC.CELLS[0,1] :=   '01/07/' + ANO;
                SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
                SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES),0));
                PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
                IF PRIMERMES1 > 0 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        SGDETALLEINC.CELLS[0,2] :=   '01/08/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES1),0));
                        END;
                END
                ELSE IF MES = '08' THEN
                BEGIN
                SGDETALLEINC.CELLS[0,1] :=   '01/08/' + ANO;
                SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
                SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES),0));
                PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
                IF PRIMERMES1 > 0 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        SGDETALLEINC.CELLS[0,2] :=   '01/09/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES1),0));
                        END;
                END
                ELSE IF MES = '09' THEN
                BEGIN
                SGDETALLEINC.CELLS[0,1] :=   '01/09/' + ANO;
                SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
                SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES),0));
                PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
                IF PRIMERMES1 > 0 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        SGDETALLEINC.CELLS[0,2] :=   '01/10/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES1),0));
                        END;
                END
                ELSE IF MES = '10' THEN
                BEGIN
                SGDETALLEINC.CELLS[0,1] :=   '01/10/' + ANO;
                SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
                SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES),0));
                PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
                IF PRIMERMES1 > 0 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        SGDETALLEINC.CELLS[0,2] :=   '01/11/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES1),0));
                        END;
                END
                ELSE IF MES = '11' THEN
                BEGIN
                SGDETALLEINC.CELLS[0,1] :=   '01/11/' + ANO;
                SGDETALLEINC.CELLS[1,1] := INTTOSTR(PRIMERMES);
                SGDETALLEINC.CELLS[2,1] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES),0));
                PRIMERMES1 := STRTOINT(EDTDIASLIQUIDADOS.TEXT)-(PRIMERMES);
                IF PRIMERMES1 > 0 THEN
                        BEGIN
                        SGDETALLEINC.ROWCOUNT := SGDETALLEINC.ROWCOUNT +1;
                        SGDETALLEINC.CELLS[0,2] :=   '01/12/' + ANO;
                        SGDETALLEINC.CELLS[1,2] := INTTOSTR(PRIMERMES1);
                        SGDETALLEINC.CELLS[2,2] := FLOATTOSTR(ROUNDTO(((STRTOINT(EDTVALORLIQUIDADO.TEXT)/STRTOINT(EDTDIASLIQUIDADOS.TEXT))* PRIMERMES1),0));
                        END;
                END;





END;


PROCEDURE TFRMINCAPACIDADES.GRABARINCAPACIDADES;
VAR I : INTEGER;
BEGIN
IF  EDTVALORLIQUIDADO.TEXT <> '' THEN
BEGIN
 TRY

     DATAMODULE1.DTBDATAMEC.STARTTRANSACTION;
     DATAMODULE1.QRYINCAPACIDADES.CACHEDUPDATES := TRUE;
     DATAMODULE1.QRYDETINCAPACIDAD.CACHEDUPDATES := TRUE;
     DATAMODULE1.QRYINCAPACIDADES.CLOSE;
     DATAMODULE1.QRYINCAPACIDADES.SQL.CLEAR;
     DATAMODULE1.QRYINCAPACIDADES.SQL.ADD('SELECT * FROM INCAPACIDADES WHERE NUM_INCAPACIDAD = :"INCAPACIDAD"');
     DATAMODULE1.QRYINCAPACIDADES.PARAMS[0].ASSTRING := EDTNUMERO.TEXT;
     DATAMODULE1.QRYINCAPACIDADES.REQUESTLIVE := TRUE;
     DATAMODULE1.QRYINCAPACIDADES.OPEN;

        IF DATAMODULE1.QRYINCAPACIDADES.RECORDCOUNT > 0 THEN
        BEGIN
        DATAMODULE1.QRYINCAPACIDADES.EDIT;
        DATAMODULE1.QRYINCAPACIDADESFEC_MODIFICACION.VALUE := STRTOdate(GLDATE);
        END
        ELSE  IF DATAMODULE1.QRYINCAPACIDADES.RECORDCOUNT = 0 THEN
                BEGIN
                DATAMODULE1.QRYINCAPACIDADES.INSERT;
                DATAMODULE1.QRYINCAPACIDADESFEC_DIGITACION.VALUE := STRTODATE(GLDATE);
                END;
        DATAMODULE1.QRYINCAPACIDADESNUM_INCAPACIDAD.VALUE :=EDTNUMERO.TEXT;
        IF RGTIPOINCAPACIDAD.ITEMINDEX = 0 THEN
        BEGIN
        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('TIP_INCAPACIDAD').VALUE := 'EGA';
        END
                ELSE IF RGTIPOINCAPACIDAD.ITEMINDEX = 1 THEN
                        BEGIN
                        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('TIP_INCAPACIDAD').VALUE := 'EGH';
                        END
                        ELSE IF RGTIPOINCAPACIDAD.ITEMINDEX = 2 THEN
                                BEGIN
                                DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('TIP_INCAPACIDAD').VALUE := 'MAT';
                                END;


        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('FEC_EXPEDICION').VALUE :=DTPFECEXPEDICION.DATE;
        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('TIP_DOCEMPRESA').VALUE :=CBTIPODOCEMPRESA.TEXT;
        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('NUM_DOCEMPRESA').VALUE :=EDTNUMDOCEMPRESA.TEXT;
        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('COD_DIAGNOSTICO').VALUE :=EDTCODDIAGNOSTICO.TEXT;
        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('AFI_TIPO_DOC').VALUE :=CBTIPODOCAFILIADO.TEXT;
        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('AFI_NUMERO_DOC').VALUE :=EDTNUMDOCAFILIADOIN.TEXT;
        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('COD_PRESTADOR').VALUE :=EDTCODPRESTADOR.TEXT;
        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('NOM_PRESTADOR').VALUE :=EDTNOMBREPRESTADOR.TEXT;
        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('DIA_INCAPACIDAD').VALUE :=EDTDIASINCAPACIDAD.TEXT;
        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('DIA_LIQUIDADOS').VALUE :=EDTDIASLIQUIDADOS.TEXT;
        DATAMODULE1.qryincapacidadesTOT_DIAS_PRORROGA.VALUE := Edit2.Text;


         IF CHPRORROGA.CHECKED = TRUE THEN
           BEGIN
            DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('PRO_INCAPACIDAD').VALUE := 'S';
            DATAMODULE1.qryincapacidadesNO_PRORROGA.VALUE := Edit1.Text;
            DATAMODULE1.qryincapacidadesTOT_DIAS_PRORROGA.VALUE := Edit2.Text;

            END
            ELSE IF CHPRORROGA.CHECKED = FALSE THEN
                 BEGIN
                 DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('PRO_INCAPACIDAD').VALUE := 'N';
                 DATAMODULE1.qryincapacidadesNO_PRORROGA.VALUE := '0';
                 DATAMODULE1.qryincapacidadesTOT_DIAS_PRORROGA.VALUE := Edit2.Text;

                 END;

        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('SAL_BASE').VALUE :=EDTSALARIOBASE.TEXT;
        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('PRO_SALARIO_LIQUI').VALUE :=EDTPROLIQUIDACION.TEXT;
        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('VAL_INCAPACIDAD').VALUE :=EDTVALORLIQUIDADO.TEXT;
        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('EST_INCAPACIDAD').VALUE := ESTADO_INCAPACIDAD;
        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('COD_OFICINA').VALUE :=GLOFICINA;
        DATAMODULE1.QRYINCAPACIDADES.FIELDBYNAME('COD_REGIONAL').VALUE :=GLREGIONAL;
        DATAMODULE1.QRYINCAPACIDADESTIP_DOC_USUARIO.VALUE :=GLTIPO;
        DATAMODULE1.QRYINCAPACIDADESTIP_NUM_USUARIO.VALUE :=GLNUMERO;
        DATAMODULE1.QRYINCAPACIDADESFEC_INICIO.VALUE := DTPFECINICIACION.DATE;
        DATAMODULE1.QRYINCAPACIDADESFEC_TERMINACION.VALUE := STRTODATE(EDTFINAL.TEXT);
        DATAMODULE1.QRYINCAPACIDADES.POST;
        DATAMODULE1.QRYINCAPACIDADES.COMMITUPDATES;
        DATAMODULE1.QRYINCAPACIDADES.CLOSE;


         // GRABAR  LA  LIQUIDACION DE  LA  INCAPACIDAD

          FOR I := 1 TO SGDETALLEINC.ROWCOUNT - 1 DO
          BEGIN
                IF TRIM(SGDETALLEINC.CELLS[0,I]) <> '' THEN
                BEGIN

                DATAMODULE1.QRYDETINCAPACIDAD.CLOSE;
                DATAMODULE1.QRYDETINCAPACIDAD.SQL.CLEAR;
                DATAMODULE1.QRYDETINCAPACIDAD.SQL.ADD('SELECT * FROM DET_INCAPACIDAD WHERE NUM_INCAPACIDAD =  :"INCPA" AND PER_PAGO_INCAP = :"PERIODO"');
                DATAMODULE1.QRYDETINCAPACIDAD.PARAMS[0].ASSTRING := EDTNUMERO.TEXT;
                DATAMODULE1.QRYDETINCAPACIDAD.PARAMS[1].ASSTRING := TRIM(SGDETALLEINC.CELLS[0,I]);
                DATAMODULE1.QRYDETINCAPACIDAD.REQUESTLIVE := TRUE;
                DATAMODULE1.QRYDETINCAPACIDAD.OPEN;
                IF DATAMODULE1.QRYDETINCAPACIDAD.RECORDCOUNT > 0 THEN
                BEGIN
           DATAMODULE1.QRYDETINCAPACIDAD.EDIT;
             END
            ELSE IF DATAMODULE1.QRYDETINCAPACIDAD.RECORDCOUNT = 0 THEN
                BEGIN
                DATAMODULE1.QRYDETINCAPACIDAD.INSERT;
                END;
                DATAMODULE1.QRYDETINCAPACIDAD.FIELDBYNAME('NUM_INCAPACIDAD').VALUE := TRIM(EDTNUMERO.TEXT);
                DATAMODULE1.QRYDETINCAPACIDAD.FIELDBYNAME('PER_PAGO_INCAP').VALUE := TRIM(SGDETALLEINC.CELLS[0,I]);
                DATAMODULE1.QRYDETINCAPACIDAD.FIELDBYNAME('DIA_PAGAR_INCAP').VALUE := STRTOINT(SGDETALLEINC.CELLS[1,I]);
                DATAMODULE1.QRYDETINCAPACIDAD.FIELDBYNAME('VAL_PAGAR_INCAP').VALUE := STRTOINT(SGDETALLEINC.CELLS[2,I]);
                DATAMODULE1.qrydetincapacidadNUM_COMPROBANTE.VALUE := '0';
                DATAMODULE1.QRYDETINCAPACIDAD.POST;
                DATAMODULE1.QRYDETINCAPACIDAD.COMMITUPDATES;
                DATAMODULE1.QRYDETINCAPACIDAD.CLOSE;
                END;
          END;
           DATAMODULE1.DTBDATAMEC.COMMIT;
          IF MESSAGEDLG (LowerCase(' Desea  Imprimir  la  Incapacidad ?'), MTCONFIRMATION, [MBYES, MBNO], 0) = MRYES THEN
          BEGIN
          imprimir_incapacidad
          end;
          EDTNUMERO.TEXT := '0';
          LIMPIAR;
    EXCEPT
        DATAMODULE1.DTBDATAMEC.ROLLBACK;
        SHOWMESSAGE(LowerCase('NO SE PUEDE  GRABAR LA INCAPACIDAD PORQUE  TIENE  ERRORES'));
        FRMPROCESO.FREE;
        RAISE;
     END;

 END;

END;

PROCEDURE TFRMINCAPACIDADES.BUTTON2CLICK(SENDER: TOBJECT);
BEGIN


                liquidar_incapacidad;
                DATAMODULE1.QRYDETINCAPACIDAD.CLOSE;
                DATAMODULE1.QRYDETINCAPACIDAD.SQL.CLEAR;
                DATAMODULE1.QRYDETINCAPACIDAD.SQL.ADD('DELETE  FROM DET_INCAPACIDAD WHERE NUM_INCAPACIDAD =  :"INCPA"');
                DATAMODULE1.QRYDETINCAPACIDAD.PARAMS[0].ASSTRING := EDTNUMERO.TEXT;
                DATAMODULE1.QRYDETINCAPACIDAD.REQUESTLIVE := TRUE;
                DATAMODULE1.QRYDETINCAPACIDAD.ExecSQL;
                DATAMODULE1.QRYDETINCAPACIDAD.CLOSE;

 // CUANDO LOS  DIAS LIQUIDADOS  SON MAYORES A 0 DIAS
  IF (EDTVALORLIQUIDADO.TEXT > '0') AND (EDTDIASLIQUIDADOS.TEXT > '0') THEN
  BEGIN
    IF  SGDETALLEINC.CELLS[0,1] = ''THEN
    BEGIN
    SHOWMESSAGE(LowerCase('DEBE  LIQUIDAR  LA FORMA  DE  PAGO DE LA INCAPACIDAD'));
    END
    ELSE IF  SGDETALLEINC.CELLS[0,1] > '0'THEN
          BEGIN
          ESTADO_INCAPACIDAD := 'SDE';
          GRABARINCAPACIDADES;
          Edtnumero.SetFocus;

          END;
  END;

// INCAPACIDADES  QUE NO SE  PAGAN POR  NO TIENE  DIAS  PARA  LIQUIDAR

        IF (EDTVALORLIQUIDADO.TEXT = '0') AND (EDTDIASLIQUIDADOS.TEXT = '0') AND (EDTDIASINCAPACIDAD.TEXT > '0') THEN
        BEGIN
        ESTADO_INCAPACIDAD := 'DES';
        GRABARINCAPACIDADES;
        END;



END;

FUNCTION TFRMINCAPACIDADES.VALIDAR: BOOLEAN;
BEGIN
VALIDAR := FALSE;
IF CBTIPODOCAFILIADO.ITEMINDEX = -1 THEN
   BEGIN
   VALIDAR := TRUE;
   SHOWMESSAGE(LowerCase('EL TIPO DE  DOCUMENTO DEL AFILIADO ESTA EN BLANCO'));
   END;
IF CBTIPODOCEMPRESA.ITEMINDEX = -1 THEN
  BEGIN
   VALIDAR := TRUE;
   SHOWMESSAGE(LowerCase('EL TIPO DE  DOCUMENTO DE LA EMPRESA EN BLANCO'));
   END;

IF EDTNUMDOCAFILIADOIN.TEXT = '' THEN
        BEGIN
        VALIDAR := TRUE;
        SHOWMESSAGE(LowerCase('EL NUMERO DE  DOCUMENTO DEL AFILIADO EN BLANCO'));
        END;
IF EDTNUMDOCEMPRESA.TEXT = '' THEN
        BEGIN
        VALIDAR := TRUE;
        SHOWMESSAGE(LowerCase('EL NUMERO DE  DOCUMENTO DE LA  EMPRESA EN BLANCO'));
        END;
IF EDTCODDIAGNOSTICO.TEXT = '' THEN
        BEGIN
        VALIDAR := TRUE;
        SHOWMESSAGE(LowerCase('INCAPACIDAD SIN DIAGNOSTICO'));
        END;
IF EDTDIASINCAPACIDAD.TEXT = '' THEN
        BEGIN
        VALIDAR := TRUE;
        SHOWMESSAGE(LowerCase('NO TIENE  NUMERO DE  DIAS  LA  INCAPACIDAD'));
        END;

IF EDTPROLIQUIDACION.TEXT = '' THEN
        BEGIN
        VALIDAR := TRUE;
        SHOWMESSAGE(LowerCase('PROMEDIO DE LIQUIDACION EN BLANCO'));
        END;
IF RGTIPOINCAPACIDAD.ITEMINDEX = -1 THEN
        BEGIN
        VALIDAR := TRUE;
        SHOWMESSAGE(LowerCase('ESCOJA  EL TIPO DE  INCAPACIDAD'));
        END;

IF EDTCODPRESTADOR.TEXT = '' THEN
        BEGIN
        VALIDAR := TRUE;
        SHOWMESSAGE(LowerCase('DIGITE  EL  CODIGO DEL  PRESTADOR  O ESCOJALO DE LA  LISTA'));
        END;
IF EDTNOMBREPRESTADOR.TEXT = '' THEN
        BEGIN
        VALIDAR := TRUE;
        SHOWMESSAGE(LowerCase('DIGITE  EL NOMBRE  DEL PRESTADOR  QUE  EMITIO LA  INCAPACIDAD'));
        END;

IF EDTVALORLIQUIDADO.TEXT = '' THEN
        BEGIN
        VALIDAR := TRUE;
        SHOWMESSAGE(LowerCase('DEBE  LIQUIDAR  LA  INCAPACIDAD ANTES VER LOS  DESCUENTOS EN EL PERIODO'));
        END;


END;

PROCEDURE TFRMINCAPACIDADES.EDTSALARIOBASEENTER(SENDER: TOBJECT);
BEGIN
DIASLIQUIDADOS;
END;



PROCEDURE TFRMINCAPACIDADES.VERIFICAR_INCAPACIDADES;
  VAR  I : INTEGER;

BEGIN

IF EDTCODDIAGNOSTICO.TEXT > '0' THEN
BEGIN
     IF RGTIPOINCAPACIDAD.ITEMINDEX <= 1 THEN
     BEGIN
     DATAMODULE1.QRYINCAPACIDADES.CLOSE;
     DATAMODULE1.QRYINCAPACIDADES.SQL.CLEAR;
     DATAMODULE1.QRYINCAPACIDADES.REQUESTLIVE := FALSE;
     DATAMODULE1.QRYINCAPACIDADES.SQL.ADD('SELECT * FROM INCAPACIDADES WHERE  AFI_TIPO_DOC = :"TIPO" AND AFI_NUMERO_DOC = :"DOCUMENTO" AND COD_DIAGNOSTICO = :"DIAGNOSTICO" AND TIP_INCAPACIDAD <> :"TIPINCAP" AND FEC_TERMINACION = :"FECHAFINAL"');
     DATAMODULE1.QRYINCAPACIDADES.PARAMS[0].ASSTRING := CBTIPODOCAFILIADO.TEXT;
     DATAMODULE1.QRYINCAPACIDADES.PARAMS[1].ASSTRING := EDTNUMDOCAFILIADOIN.TEXT;
     DATAMODULE1.QRYINCAPACIDADES.PARAMS[2].ASSTRING := EDTCODDIAGNOSTICO.TEXT;
     DATAMODULE1.QRYINCAPACIDADES.PARAMS[3].ASSTRING := 'MAT';
     DATAMODULE1.QRYINCAPACIDADES.PARAMS[4].ASDATEtime := (DTPFECINICIACION.DATE -1);
     DATAMODULE1.QRYINCAPACIDADES.OPEN;
         IF DATAMODULE1.QRYINCAPACIDADES.RECORDCOUNT > 0 THEN
         BEGIN
          IF DATAMODULE1.QRYINCAPACIDADESPRO_INCAPACIDAD.VALUE = 'N' THEN
          BEGIN
           SHOWMESSAGE(LowerCase('ESTA  INCAPACIDAD ES  UNA  PRORROGA  DE LA INCAPACIDAD  NO. :'+ (DATAMODULE1.QRYINCAPACIDADESNUM_INCAPACIDAD.VALUE) +' QUE NO ES UNA PRORROGA'));
           Edit1.Text := DATAMODULE1.QRYINCAPACIDADESNUM_INCAPACIDAD.VALUE;
           END
          ELSE
          SHOWMESSAGE(LowerCase('ESTA  INCAPACIDAD ES  UNA  PRORROGA  DE LA INCAPACIDAD  NO. : '+ (DATAMODULE1.QRYINCAPACIDADESNUM_INCAPACIDAD.VALUE)+ ' QUE  ES UNA PRORROGA'));
          Edit1.Text := DATAMODULE1.QRYINCAPACIDADESNUM_INCAPACIDAD.VALUE;
          CHPRORROGA.CHECKED := TRUE;
           END
         ELSE IF DATAMODULE1.QRYINCAPACIDADES.RECORDCOUNT = 0 THEN
         BEGIN
         CHPRORROGA.CHECKED := FALSE;
         END;
     END
     ELSE IF RGTIPOINCAPACIDAD.ITEMINDEX = 2 THEN
          BEGIN
         DATAMODULE1.QRYINCAPACIDADES.CLOSE;
         DATAMODULE1.QRYINCAPACIDADES.SQL.CLEAR;
         DATAMODULE1.QRYINCAPACIDADES.SQL.ADD('SELECT * FROM  INCAPACIDADES WHERE AFI_TIPO_DOC = :"TIPO" AND AFI_NUMERO_DOC = :"NUMERO" AND  FEC_INICIO <= :"FECHAI" AND FEC_TERMINACION >= :"FECHAF"');
         DATAMODULE1.QRYINCAPACIDADES.PARAMS[0].ASSTRING := CBTIPODOCAFILIADO.TEXT;
         DATAMODULE1.QRYINCAPACIDADES.PARAMS[1].ASSTRING := EDTNUMDOCAFILIADOIN.TEXT;
         DATAMODULE1.QRYINCAPACIDADES.PARAMS[2].ASDATEtime := (DTPFECINICIACION.DATE -270);
         DATAMODULE1.QRYINCAPACIDADES.PARAMS[3].ASDATEtime := (DTPFECINICIACION.DATE );
         DATAMODULE1.QRYINCAPACIDADES.OPEN;
             IF DATAMODULE1.QRYINCAPACIDADES.RECORDCOUNT > 0 THEN
             BEGIN
             SHOWMESSAGE(LowerCase('EL  AFILIADO NO PUEDE  TENER  UNA  LICENCIA  DE MATERNIDAD POR QUE  SU  ULTIMA INCAPACIDAD TERMINO' + DATETOSTR(DATAMODULE1.QRYINCAPACIDADESFEC_TERMINACION.VALUE )));
             LIMPIAR;
             EDTNUMERO.SETFOCUS;
             END;
          END;
     END;
END;
PROCEDURE TFRMINCAPACIDADES.EDTCODDIAGNOSTICOCLICK(SENDER: TOBJECT);
BEGIN
 IF EDTNUMDOCAFILIADOIN.TEXT = '0' THEN
    BEGIN
    SHOWMESSAGE(LowerCase(' SELECIONE  EL USUARIO'));
    EDTNUMDOCAFILIADOIN.SETFOCUS;
    END;
END;

PROCEDURE TFRMINCAPACIDADES.EDTPROLIQUIDACIONCLICK(SENDER: TOBJECT);
BEGIN
IF ENCONTRO = FALSE THEN
  BEGIN
VERIFICAR_INCAPACIDADES;
END;
END;

PROCEDURE TFRMINCAPACIDADES.VERIFICAR_CARTERA;
BEGIN
        IF (CBTIPODOCAFILIADO.ITEMINDEX >= 0)  AND (EDTNUMDOCAFILIADOIN.TEXT >'0') THEN
        BEGIN

                DATAMODULE1.QRYCARTERA.CLOSE;
                DATAMODULE1.QRYCARTERA.SQL.CLEAR;
                DATAMODULE1.QRYCARTERA.SQL.ADD('SELECT * FROM CARTERA WHERE TIP_DOCUMENTO = :"TIPO" AND NUM_DOCUMENTO = :"COTIZANTE" AND TIPO_MORA >:"ESTADO"');
                DATAMODULE1.QRYCARTERA.PARAMS[0].ASSTRING := CBTIPODOCAFILIADO.TEXT;
                DATAMODULE1.QRYCARTERA.PARAMS[1].ASSTRING := EDTNUMDOCAFILIADOIN.TEXT;
                DATAMODULE1.QRYCARTERA.PARAMS[2].ASSTRING := '0';
                DATAMODULE1.QRYCARTERA.OPEN;
                        IF DATAMODULE1.QRYCARTERA.RECORDCOUNT > 0 THEN
                        BEGIN
                        SHOWMESSAGE(LowerCase('ESTE  USUARIO  TIENE  '+ INTTOSTR(DATAMODULE1.QRYCARTERA.RECORDCOUNT) + '  PERIODOS EN MORA  Y  LA ' + RGTIPOINCAPACIDAD.TEXT + ' NO SE PUEDE LIQUIDAR'));
                        LIMPIAR;
                        EDTNUMERO.SETFOCUS;
                        END;
        END;
END;



PROCEDURE TFRMINCAPACIDADES.APPMESSAGE(VAR MSG: TMSG;
  VAR HANDLED: BOOLEAN);
BEGIN

     IF MSG.WPARAM = VK_RETURN THEN
    BEGIN
        IF (((SCREEN.ACTIVECONTROL) IS TEDIT)) THEN
                MSG.WPARAM := VK_TAB;
        IF (((SCREEN.ACTIVECONTROL) IS TCOMBOBOX)) THEN
                MSG.WPARAM := VK_TAB;
        IF (((SCREEN.ACTIVECONTROL) IS TDATETIMEPICKER)) THEN
                MSG.WPARAM := VK_TAB;
        IF (((SCREEN.ACTIVECONTROL) IS TBitBtn)) THEN
                MSG.WPARAM := VK_TAB;
        IF (((SCREEN.ACTIVECONTROL) IS TCheckBox)) THEN
                MSG.WPARAM := VK_TAB;
    END;
END;

PROCEDURE TFRMINCAPACIDADES.CERRAR1CLICK(SENDER: TOBJECT);
BEGIN
FRMINCAPACIDADES.CLOSE
END;

PROCEDURE TFRMINCAPACIDADES.ENVIARWORD;
VAR
WORDOBJECT : TWORDOBJECT;
I,J : INTEGER;
FECHAFIN : TDATE;
BEGIN
WORDOBJECT:=TWORDOBJECT.CREATE;
WORDOBJECT.NEWDOC('');
WORDOBJECT.CAPTION := RGTIPOINCAPACIDAD.TEXT + ' ' + EDTNUMERO.TEXT;
WORDOBJECT.VISIBLE := TRUE;
WORDOBJECT.INSERTTEXT('FECHA ' +  GLDATE + #13#13); //ABRIR  DOS  LINEAS  EN  WORD
WORDOBJECT.INSERTTEXT('                  AUTORIZACION  DE  DESCUENTOS  INCAPACIDADES' + #13); //ABRIR  DOS  LINEAS  EN  WORD
WORDOBJECT.INSERTTEXT('                             O LICENCIA  DE  MATERNIDAD' + #13#13#13#13); //ABRIR  DOS  LINEAS  EN  WORD
WORDOBJECT.INSERTTEXT('      '+#9 + RGTIPOINCAPACIDAD.TEXT +  ' NUMERO : ' + EDTNUMERO.TEXT + #13#13 ); //ABRIR  DOS  LINEAS  EN  WORD
WORDOBJECT.INSERTTEXT('                             DATOS  DE LA  EMPRESA' + #13#13); //ABRIR  DOS  LINEAS  EN  WORD

    DATAMODULE1.QRYEMPRESAS.DISABLECONTROLS;
    DATAMODULE1.QRYEMPRESAS.CLOSE;
    DATAMODULE1.QRYEMPRESAS.PREPARE;
    DATAMODULE1.QRYEMPRESAS.PARAMBYNAME('PTIPO').VALUE := TRIM(CBTIPODOCEMPRESA.TEXT);
    DATAMODULE1.QRYEMPRESAS.PARAMBYNAME('PNUMERO').VALUE := TRIM(EDTNUMDOCEMPRESA.TEXT);
    DATAMODULE1.QRYEMPRESAS.OPEN;
    DATAMODULE1.QRYEMPRESAS.ENABLECONTROLS;

WORDOBJECT.INSERTTEXT('EMPRESA              :'+#9 + DATAMODULE1.QRYEMPRESASNOM_EMPRESA.VALUE + #13  ); //ABRIR  DOS  LINEAS  EN  WORD
WORDOBJECT.INSERTTEXT('NIT                         :'+#9 + CBTIPODOCEMPRESA.TEXT + ' ' + EDTNUMDOCEMPRESA.TEXT + #13); //ABRIR  DOS  LINEAS  EN  WORD
WORDOBJECT.INSERTTEXT('ATENCION             :'+#9 +  #13); //ABRIR  DOS  LINEAS  EN  WORD
WORDOBJECT.INSERTTEXT('DIRECCION            :'+#9 + DATAMODULE1.QRYEMPRESASDIR_EMPRESA.VALUE + #13); //ABRIR  DOS  LINEAS  EN  WORD
WORDOBJECT.INSERTTEXT('TELEFONOS           :'+#9 + DATAMODULE1.QRYEMPRESASTEL_EMPRESA.VALUE + DATAMODULE1.QRYEMPRESASTEL_EMPRESA2.VALUE + #13#13#13#13); //ABRIR  DOS  LINEAS  EN  WORD
WORDOBJECT.INSERTTEXT('                             DATOS  DEL  COTIZANTE ' + #13#13); //ABRIR  DOS  LINEAS  EN  WORD
WORDOBJECT.INSERTTEXT('PERTENCECE A      :'+#9 + EDTNOMBREAFILIADO.TEXT + #13); //ABRIR  DOS  LINEAS  EN  WORD
WORDOBJECT.INSERTTEXT('DOCUMENTO          :'+#9 + CBTIPODOCAFILIADO.TEXT + ' ' + EDTNUMDOCAFILIADOIN.TEXT + #13); //ABRIR  DOS  LINEAS  EN  WORD
WORDOBJECT.INSERTTEXT('FECHA INICIO        :'+#9 + DATETOSTR(DTPFECINICIACION.DATE) + ' HASTA  EL ' + EDTFINAL.TEXT + #13); //ABRIR  DOS  LINEAS  EN  WORD
WORDOBJECT.INSERTTEXT('DIAS INCAPACIDAD :'+#9 + VALORLETRADIAS.TEXT + '(' + EDTDIASLIQUIDADOS.TEXT +')' + #13#13); //ABRIR  DOS  LINEAS  EN  WORD
WORDOBJECT.INSERTTEXT('                            DESCUENTOS  AUTORORIZADOS POR PERIODO' + #13#13); //ABRIR  DOS  LINEAS  EN  WORD

  FOR I := 0 TO SGDETALLEINC.ROWCOUNT - 1 DO
  BEGIN

         FOR J:= 0 TO 2 DO
         WORDOBJECT.INSERTTEXT('¦              ' + SGDETALLEINC.CELLS[J,I]+ #9#9);
         WORDOBJECT.INSERTTEXT ('¦________________________________________________________________¦');
         WORDOBJECT.INSERTTEXT(#13); // REALIZAR CONXION  CON  AUTOIMPL
  END;


END;

PROCEDURE TFRMINCAPACIDADES.USUARIOS1CLICK(SENDER: TOBJECT);
BEGIN
FRMINCAPORUSUARIO:=TFRMINCAPORUSUARIO.CREATE(APPLICATION);
        TRY
        FRMINCAPORUSUARIO.SHOW;
        //FINALLY
        EXCEPT
        FRMINCAPORUSUARIO.FREE;
        END;

END;

PROCEDURE TFRMINCAPACIDADES.INCAPACIDADVIGENTE;
BEGIN
     DATAMODULE1.QRYINCAPACIDADES.CLOSE;
     DATAMODULE1.QRYINCAPACIDADES.SQL.CLEAR;
     DATAMODULE1.QRYINCAPACIDADES.SQL.ADD('SELECT * FROM  INCAPACIDADES WHERE AFI_TIPO_DOC = :"TIPO" AND AFI_NUMERO_DOC = :"NUMERO" AND  FEC_INICIO <= :"FECHAI" AND FEC_TERMINACION >= :"FECHAF"');
     DATAMODULE1.QRYINCAPACIDADES.PARAMS[0].ASSTRING := CBTIPODOCAFILIADO.TEXT;
     DATAMODULE1.QRYINCAPACIDADES.PARAMS[1].ASSTRING := EDTNUMDOCAFILIADOIN.TEXT;
     DATAMODULE1.QRYINCAPACIDADES.PARAMS[2].ASDATE := DTPFECINICIACION.DATE;
     DATAMODULE1.QRYINCAPACIDADES.PARAMS[3].ASDATE := DTPFECINICIACION.DATE;
     DATAMODULE1.QRYINCAPACIDADES.OPEN;
        IF DATAMODULE1.QRYINCAPACIDADES.RECORDCOUNT > 0 THEN
        BEGIN
        SHOWMESSAGE(LowerCase('EL AFILIADO TIENE LA   INCAPACIDAD NUMERO '+ DATAMODULE1.QRYINCAPACIDADESNUM_INCAPACIDAD.VALUE + ' VIGENTE POR ' + (DATAMODULE1.QRYINCAPACIDADESTIP_INCAPACIDAD.VALUE) + 'TERMINA ' + DATETOSTR(DATAMODULE1.QRYINCAPACIDADESFEC_TERMINACION.VALUE )));
        LIMPIAR;
        EDTNUMERO.SETFOCUS;
        END;
END;

procedure TFRMINCAPACIDADES.liquidar_incapacidad;
VAR I : INTEGER;
 BEGIN
  IF VALIDAR = FALSE THEN
   BEGIN
        IF EDTVALORLIQUIDADO.TEXT > '0' THEN
        BEGIN
        IF RGTIPOINCAPACIDAD.ITEMINDEX <= 1 THEN
                BEGIN
                 IF EDTDIASLIQUIDADOS.TEXT > '0' THEN
                   BEGIN

                   SGDETALLEINC.ROWCOUNT := 2;
                   SGDETALLEINC.CELLS[0,1]:='';
                   SGDETALLEINC.CELLS[1,1]:='';
                   SGDETALLEINC.CELLS[2,1]:='';
                   SGDETALLEINC.CELLS[3,1]:='';
                   SGDETALLEINC.CELLS[4,1]:='';
                   SGDETALLEINC.CELLS[5,1]:='';
                   SGDETALLEINC.CELLS[6,1]:='';
                   PAGOEFERMEDADGENERAL;
                   END
                   ELSE IF EDTDIASLIQUIDADOS.TEXT = '0' THEN
                     BEGIN
                     SHOWMESSAGE(LowerCase('NO SE PUEDE LIQUIDAR LA  INCAPACIDAD PORQUE  TIENE 0 DIAS '));
                     END;
                END
                ELSE IF RGTIPOINCAPACIDAD.ITEMINDEX = 2 THEN
                        BEGIN
                        IF EDTDIASLIQUIDADOS.TEXT > '0' THEN
                                BEGIN
                                SGDETALLEINC.ROWCOUNT := 2;
                                SGDETALLEINC.CELLS[0,1]:='';
                                SGDETALLEINC.CELLS[1,1]:='';
                                SGDETALLEINC.CELLS[2,1]:='';
                                SGDETALLEINC.CELLS[3,1]:='';
                                SGDETALLEINC.CELLS[4,1]:='';
                                SGDETALLEINC.CELLS[5,1]:='';
                                SGDETALLEINC.CELLS[6,1]:='';
                                PAGOLINCENCIAS;
                                END
                                ELSE IF EDTDIASLIQUIDADOS.TEXT = '0' THEN
                                        BEGIN
                                        SHOWMESSAGE(LowerCase('NO SE PUEDE LIQUIDAR LA  INCAPACIDAD PORQUE  TIENE 0 DIAS '));
                                        END;

                END;

        END;
   END;

end;

procedure TFRMINCAPACIDADES.Button1Click(Sender: TObject);
begin
        IF STRTOINT(EDTNUMERO.TEXT) > 0 THEN
        BEGIN
        EDTNUMERO.TEXT :=FLOATTOSTR(STRTOINT(EDTNUMERO.TEXT));
        DATAMODULE1.QRYINCAPACIDADES.CLOSE;
        DATAMODULE1.QRYINCAPACIDADES.SQL.CLEAR;
        DATAMODULE1.QRYINCAPACIDADES.SQL.ADD('SELECT * FROM INCAPACIDADES WHERE NUM_INCAPACIDAD = :"INCAPACIDAD"');
        DATAMODULE1.QRYINCAPACIDADES.PARAMS[0].ASSTRING := EDTNUMERO.TEXT;
        DATAMODULE1.QRYINCAPACIDADES.OPEN;
                IF DATAMODULE1.QRYINCAPACIDADES.RECORDCOUNT = 0 THEN
                BEGIN
                SHOWMESSAGE(LowerCase('Debe Grabar la  Incapacidad para  Porderla  imprimir '));
                END
                ELSE
                begin
                imprimir_incapacidad;
             end;
        end
        ELSE SHOWMESSAGE(LowerCase(LowerCase('NO EXISTE  NINGUNA  INCAPACIDAD  EN LA  PANTALLA, DEBE SELECIONARLA')));

end;

procedure TFRMINCAPACIDADES.dtpfecexpedicionExit(Sender: TObject);
begin
    if strtodate(GLDATE) < dtpfecexpedicion.Date then
    begin
    SHOWMESSAGE(LowerCase(LowerCase('La Fecha   de Expedicion No debe Ser Mayor al dia  de Hoy')));
    dtpfecexpedicion.SetFocus;
    end
    else
    IF (strtodate(gldate) - 1095)  > DTPFECINICIACION.DATE THEN
         BEGIN
         SHOWMESSAGE(LowerCase(LowerCase('LA  IMCAPACIDAD NO PUEDE  TENER  MAS  DE 3 AÑOS de Expedicion')));
         LIMPIAR;
         END
end;
procedure TFRMINCAPACIDADES.cbtipodocempresaExit(Sender: TObject);
begin
if cbtipodocempresa.Text = '' then
begin
ShowMessage(LowerCase(' Selecione  el tipo de Documento de la Empresa'));
cbtipodocempresa.SetFocus;
exit;
end;

end;

procedure TFRMINCAPACIDADES.cbtipodocafiliadoExit(Sender: TObject);
begin
if cbtipodocafiliado.Text = '' then
begin
ShowMessage(LowerCase(' Selecione  el tipo de Documento del Afiliado'));
cbtipodocafiliado.SetFocus;
exit;
end;
end;

procedure TFRMINCAPACIDADES.Edit1Exit(Sender: TObject);
  VAR  I : INTEGER;
begin
Edit1.TEXT :=FLOATTOSTR(STRTOINT(Edit1.TEXT));
if  Edit1.Text > '0' then
  begin
     IF RGTIPOINCAPACIDAD.ITEMINDEX <= 1 THEN
     BEGIN
     DATAMODULE1.QRYINCAPACIDADES.CLOSE;
     DATAMODULE1.QRYINCAPACIDADES.SQL.CLEAR;
     DATAMODULE1.QRYINCAPACIDADES.SQL.ADD('SELECT * FROM INCAPACIDADES WHERE NUM_INCAPACIDAD = :"NUMERO" AND  AFI_TIPO_DOC = :"TIPO" AND AFI_NUMERO_DOC = :"DOCUMENTO" AND TIP_INCAPACIDAD <> :"TIP" AND FEC_TERMINACION >= :"FECHAINI" AND FEC_TERMINACION <= :"FECHAFINAL"');
     DATAMODULE1.QRYINCAPACIDADES.PARAMS[0].ASSTRING := TRIM(Edit1.TEXT);
     DATAMODULE1.QRYINCAPACIDADES.PARAMS[1].ASSTRING := CBTIPODOCAFILIADO.TEXT;
     DATAMODULE1.QRYINCAPACIDADES.PARAMS[2].ASSTRING := TRIM(EDTNUMDOCAFILIADOIN.TEXT);
     DATAMODULE1.QRYINCAPACIDADES.PARAMS[3].ASSTRING := 'MAT';
     DATAMODULE1.QRYINCAPACIDADES.PARAMS[4].ASDATEtime := (DTPFECINICIACION.DATE -30);
     DATAMODULE1.QRYINCAPACIDADES.PARAMS[5].ASDATEtime := (DTPFECINICIACION.DATE);
     DATAMODULE1.QRYINCAPACIDADES.REQUESTLIVE := FALSE;
     DATAMODULE1.QRYINCAPACIDADES.OPEN;
         IF DATAMODULE1.QRYINCAPACIDADES.RECORDCOUNT > 0 THEN
         BEGIN
          IF DATAMODULE1.QRYINCAPACIDADESPRO_INCAPACIDAD.VALUE = 'N' THEN
          BEGIN
           SHOWMESSAGE(LowerCase('ESTA  INCAPACIDAD ES  UNA  PRORROGA  DE LA INCAPACIDAD  NO. :'+ (DATAMODULE1.QRYINCAPACIDADESNUM_INCAPACIDAD.VALUE) +' QUE NO ES UNA PRORROGA'));
           Edit2.TEXT :=  FloatToStr(strtofloat(DATAMODULE1.qryincapacidadesTOT_DIAS_PRORROGA.Value) + STRTOFLOAT(edtdiasincapacidad.TEXT));
           END
          ELSE
          SHOWMESSAGE(LowerCase('ESTA  INCAPACIDAD ES  UNA  PRORROGA  DE LA INCAPACIDAD  NO. : '+ (DATAMODULE1.QRYINCAPACIDADESNUM_INCAPACIDAD.VALUE)+ ' QUE  ES UNA PRORROGA'));
          Edit2.TEXT :=  FloatToStr(strtofloat(DATAMODULE1.qryincapacidadesTOT_DIAS_PRORROGA.Value) + STRTOFLOAT(edtdiasincapacidad.TEXT));
          END
         ELSE IF DATAMODULE1.QRYINCAPACIDADES.RECORDCOUNT = 0 THEN
         BEGIN
          CHPRORROGA.CHECKED := FALSE;
          Edit1.Color := cl3DLight;
          Edit1.Text := '0';
          Edit1.Enabled := false;
          edtcodprestador.SetFocus;

         END;
     END;

  end
  else



end;

procedure TFRMINCAPACIDADES.chprorrogaClick(Sender: TObject);
begin
    if  chprorroga.Checked = true then
    begin
        IF MESSAGEDLG (LowerCase(' Esta  Seguro  que está incapacidad es una  Prorroga  de otra Incapacidad ?'), mtConfirmation, [MBYES, MBNO], 0) = MRYES THEN
        BEGIN
        Edit1.Color := clMoneyGreen;
        Edit1.Enabled := true;
        Edit1.SetFocus;
        end
        else
        begin
        Edit1.Color := cl3DLight;
        Edit1.Text := '0';
        Edit1.Enabled := false;
        edtcodprestador.SetFocus;
        end;
  end
  else
  begin
  Edit1.Color := cl3DLight;
  Edit1.Text := '0';
  Edit1.Enabled := false;
  edtcodprestador.SetFocus;
  end;
end;

procedure TFRMINCAPACIDADES.btneliminarClick(Sender: TObject);
begin
 if Edtnumero.Text > '0' then
 begin
 IF MESSAGEDLG (LowerCase(' REALMENTE  QUIERE BORRAR LA INCAPACIDAD ?'), MTCONFIRMATION, [MBYES, MBNO], 0) = MRYES THEN
  BEGIN
   // borra  el detalle  de  la  Incapacidad
        DATAMODULE1.QRYDETINCAPACIDAD.CLOSE;
        DATAMODULE1.QRYDETINCAPACIDAD.SQL.CLEAR;
        DATAMODULE1.QRYDETINCAPACIDAD.SQL.ADD('DELETE  FROM DET_INCAPACIDAD WHERE NUM_INCAPACIDAD =  :"INCPA"');
        DATAMODULE1.QRYDETINCAPACIDAD.PARAMS[0].ASSTRING := EDTNUMERO.TEXT;
        DATAMODULE1.QRYDETINCAPACIDAD.REQUESTLIVE := TRUE;
        DATAMODULE1.QRYDETINCAPACIDAD.ExecSQL;
        DATAMODULE1.QRYDETINCAPACIDAD.CLOSE;
     // borra el encabezado
        DATAMODULE1.QRYINCAPACIDADES.CLOSE;
        DATAMODULE1.QRYINCAPACIDADES.SQL.CLEAR;
        DATAMODULE1.QRYINCAPACIDADES.SQL.ADD('DELETE  FROM INCAPACIDADES WHERE NUM_INCAPACIDAD =  :"INCPA"');
        DATAMODULE1.QRYINCAPACIDADES.PARAMS[0].ASSTRING := EDTNUMERO.TEXT;
        DATAMODULE1.QRYINCAPACIDADES.REQUESTLIVE := TRUE;
        DATAMODULE1.QRYINCAPACIDADES.ExecSQL;
        DATAMODULE1.QRYINCAPACIDADES.CLOSE;

       END;
      END;

        end;

procedure TFRMINCAPACIDADES.Button4Click(Sender: TObject);
begin
GLPROCESO := 'INCAPACIDADES';
FRMPRINCIPAL.SB.PANELS[1].TEXT := 'PROCESO ABIERTO ACTUAL  :'+ GLPROCESO;
FRMEMPRESAS:=TFRMEMPRESAS.CREATE(APPLICATION);
TRY
FRMEMPRESAS.SHOW;
//FINALLY
EXCEPT
FRMEMPRESAS.FREE;
END;

end;

procedure TFRMINCAPACIDADES.Button5Click(Sender: TObject);
begin
GLPROCESO := 'INCAPACIDADES';
FRMPRINCIPAL.SB.PANELS[1].TEXT := 'PROCESO ABIERTO ACTUAL  :'+ GLPROCESO;

FRMAFILIADOS:=TFRMAFILIADOS.CREATE(APPLICATION);
TRY
FRMAFILIADOS.SHOW;
//FINALLY
EXCEPT
FRMAFILIADOS.FREE;

END;

end;

procedure TFRMINCAPACIDADES.FormActivate(Sender: TObject);
begin
WindowState := wsMaximized;
end;

procedure TFRMINCAPACIDADES.Button7Click(Sender: TObject);
begin
FRMPRESTADORES:=TFRMPRESTADORES.CREATE(APPLICATION);
TRY
FRMPRESTADORES.SHOW;
//FINALLY
EXCEPT
FRMPRESTADORES.FREE;
END;

end;

procedure TFRMINCAPACIDADES.Button6Click(Sender: TObject);
begin
FRMDIAGNOSTICOS:=TFRMDIAGNOSTICOS.CREATE(APPLICATION);
TRY
FRMDIAGNOSTICOS.SHOW;
//FINALLY
EXCEPT
FRMDIAGNOSTICOS.FREE;
end;
end;

procedure TFRMINCAPACIDADES.imprimir_incapacidad;
var i: integer;
begin
frmcertincapacidades:=Tfrmcertincapacidades.create(application);
   try
    if frmcertincapacidades.QuickRep1 <> nil then
    begin
//    frmcertincapacidades.qrnumero.Caption := Edtnumero.Text;
    if rgtipoincapacidad.ItemIndex = 0 then
      begin
        frmcertincapacidades.qrambu.Caption := 'X';
        frmcertincapacidades.qrhosp.Caption := '';
        frmcertincapacidades.qrmaternidad.Caption := '';
      end
      else
      if rgtipoincapacidad.ItemIndex = 1 then
       begin
        frmcertincapacidades.qrambu.Caption := '';
        frmcertincapacidades.qrhosp.Caption := 'X';
        frmcertincapacidades.qrmaternidad.Caption := '';
      end
      else
      if rgtipoincapacidad.ItemIndex = 2 then
        begin
        frmcertincapacidades.qrambu.Caption := '';
        frmcertincapacidades.qrhosp.Caption := '';
        frmcertincapacidades.qrmaternidad.Caption := 'X';
      end;
    frmcertincapacidades.qrape1.Caption := ape1;
    frmcertincapacidades.qrape2.Caption := ape2;
    frmcertincapacidades.qrnom1.Caption := nom1;
    frmcertincapacidades.qrnom2.Caption := nom2;
    frmcertincapacidades.tipdocumento.Caption := cbtipodocafiliado.Text;
    frmcertincapacidades.numdocumento.Caption := edtnumdocafiliadoin.Text;
    frmcertincapacidades.qrfecha.Caption := datetostr(dtpfecexpedicion.date);
    frmcertincapacidades.qrnombreempresa.Caption := edtnombreempresa.text;
    frmcertincapacidades.qrtipdocempresa.Caption := cbtipodocempresa.Text;
    frmcertincapacidades.qrnumdocempresa.Caption := edtnumdocempresa.Text;
    frmcertincapacidades.qrdignostico.Caption := edtcoddiagnostico.Text;
    frmcertincapacidades.qrfechainicio.Caption := datetostr(dtpfeciniciacion.date);
    frmcertincapacidades.qrdiasletras.Caption := valorletradias.Text;
    frmcertincapacidades.qrnumeros.Caption := edtdiasincapacidad.Text;
      if chprorroga.Checked = true then
      begin
        frmcertincapacidades.qrnumprorroga.Caption := Edit1.Text;
        frmcertincapacidades.qrsiprorroga.Caption := 'X';
        frmcertincapacidades.qrynoprorroga.Caption := '';
      end
      else
      begin
        frmcertincapacidades.qrynoprorroga.Caption := 'X';
        frmcertincapacidades.qrsiprorroga.Caption := '';
        frmcertincapacidades.qrnumprorroga.Caption := Edit1.Text;
      end;
    frmcertincapacidades.qrnommedico.Caption := edtnombreprestador.Text;
    frmcertincapacidades.qrcodigo.Caption := edtcodprestador.Text;
    frmcertincapacidades.qrsalariobase.Caption := edtproliquidacion.Text;
    frmcertincapacidades.qrdiasl.Caption := edtdiasliquidados.Text;
    frmcertincapacidades.qrvalorincapacidad.Caption := edtvalorliquidado.Text;
    frmcertincapacidades.qrydiasletras.Caption := FRMPRINCIPAL.pasarletras(StrToInt64(edtdiasliquidados.text));

    //  valores a  pagar
      FOR I := 1 TO SGDETALLEINC.ROWCOUNT - 1 DO
       BEGIN
                if (i = 1) and (TRIM(SGDETALLEINC.CELLS[0,I]) <> '') then
                 begin
                        frmcertincapacidades.qrperiodo1.Caption := TRIM(COPY(SGDETALLEINC.CELLS[0,I],4,10));
                        frmcertincapacidades.qrpervalor1.Caption := TRIM(SGDETALLEINC.CELLS[2,I]);
                        frmcertincapacidades.qrperiodo2.Caption := '';
                        frmcertincapacidades.qrvalperiodo2.Caption := '';
                        frmcertincapacidades.qrperiodo3.Caption := '';
                        frmcertincapacidades.qrvalperiodo3.Caption := '';
                        frmcertincapacidades.qrperiodo4.Caption := '';
                        frmcertincapacidades.qrvalperiodo4.Caption := '';
                  end;
                  if (i = 2) and (TRIM(SGDETALLEINC.CELLS[0,I]) <> '') then
                 begin
                        frmcertincapacidades.qrperiodo2.Caption := TRIM(COPY(SGDETALLEINC.CELLS[0,I],4,10));
                        frmcertincapacidades.qrvalperiodo2.Caption := TRIM(SGDETALLEINC.CELLS[2,I]);
                        frmcertincapacidades.qrperiodo3.Caption := '';
                        frmcertincapacidades.qrvalperiodo3.Caption := '';
                        frmcertincapacidades.qrperiodo4.Caption := '';
                        frmcertincapacidades.qrvalperiodo4.Caption := '';
                  end;
                  if (i = 3) and (TRIM(SGDETALLEINC.CELLS[0,I]) <> '') then
                 begin
                        frmcertincapacidades.qrperiodo3.Caption := TRIM(COPY(SGDETALLEINC.CELLS[0,I],4,10));
                        frmcertincapacidades.qrvalperiodo3.Caption := TRIM(SGDETALLEINC.CELLS[2,I]);
                        frmcertincapacidades.qrperiodo4.Caption := '';
                        frmcertincapacidades.qrvalperiodo4.Caption := '';
                  end;
                  if (i = 4) and (TRIM(SGDETALLEINC.CELLS[0,I]) <> '') then
                 begin
                        frmcertincapacidades.qrperiodo4.Caption := TRIM(COPY(SGDETALLEINC.CELLS[0,I],4,10));
                        frmcertincapacidades.qrvalperiodo4.Caption := TRIM(SGDETALLEINC.CELLS[2,I]);

                  end;
      end;


    frmcertincapacidades.QuickRep1.preview
    end;
   //finally
   except
      frmcertincapacidades.Free;
   end;
end;

END.


